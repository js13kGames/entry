!function(t){var i={};function e(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,e),h.l=!0,h.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)e.d(s,h,function(i){return t[i]}.bind(null,h));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=1)}([function(t,i){function e(){this.setSettings=function(t){for(var i=0;i<24;i++)this[String.fromCharCode(97+i)]=t[i]||0;this.c<.01&&(this.c=.01);var e=this.b+this.c+this.e;if(e<.18){var s=.18/e;this.b*=s,this.c*=s,this.e*=s}}}var s=new function(){var t,i,s,h,r,a,n,o,l,c,E,d;this._params=new e,this.reset=function(){var t=this._params;h=100/(t.f*t.f+.001),r=100/(t.g*t.g+.001),a=1-t.h*t.h*t.h*.01,n=-t.i*t.i*t.i*1e-6,t.a||(E=.5-t.n/2,d=5e-5*-t.o),o=1+t.l*t.l*(t.l>0?-.9:10),l=0,c=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var e=this._params;return t=e.b*e.b*1e5,i=e.c*e.c*1e5,s=e.e*e.e*1e5+12,3*((t+i+s)/3|0)},this.synthWave=function(e,_){var m=this._params,g=1!=m.s||m.v,u=m.v*m.v*.1,p=1+3e-4*m.w,f=m.s*m.s*m.s*.1,y=1+1e-4*m.t,A=1!=m.s,I=m.x*m.x,R=m.g,T=m.q||m.r,N=m.r*m.r*m.r*.2,M=m.q*m.q*(m.q<0?-1020:1020),w=m.p?32+((1-m.p)*(1-m.p)*2e4|0):0,x=m.d,D=m.j/2,O=m.k*m.k*.01,H=m.a,b=t,v=1/t,G=1/i,P=1/s,L=5/(1+m.u*m.u*20)*(.01+f);L>.8&&(L=.8),L=1-L;for(var S,W,C,Y,k,j,F=!1,B=0,$=0,U=0,X=0,V=0,z=0,K=0,Z=0,q=0,J=0,Q=new Array(1024),tt=new Array(32),it=Q.length;it--;)Q[it]=0;for(it=tt.length;it--;)tt[it]=2*Math.random()-1;for(it=0;it<_;it++){if(F)return it;if(w&&++q>=w&&(q=0,this.reset()),c&&++l>=c&&(c=0,h*=o),(h*=a+=n)>r&&(h=r,R>0&&(F=!0)),W=h,D>0&&(J+=O,W*=1+Math.sin(J)*D),(W|=0)<8&&(W=8),H||((E+=d)<0?E=0:E>.5&&(E=.5)),++$>b)switch($=0,++B){case 1:b=i;break;case 2:b=s}switch(B){case 0:U=$*v;break;case 1:U=1+2*(1-$*G)*x;break;case 2:U=1-$*P;break;case 3:U=0,F=!0}T&&((C=0|(M+=N))<0?C=-C:C>1023&&(C=1023)),g&&p&&((u*=p)<1e-5?u=1e-5:u>.1&&(u=.1)),j=0;for(var et=8;et--;){if(++K>=W&&(K%=W,3==H))for(var st=tt.length;st--;)tt[st]=2*Math.random()-1;switch(H){case 0:k=K/W<E?.5:-.5;break;case 1:k=1-K/W*2;break;case 2:k=.225*(((k=1.27323954*(Y=6.28318531*((Y=K/W)>.5?Y-1:Y))+.405284735*Y*Y*(Y<0?1:-1))<0?-1:1)*k*k-k)+k;break;case 3:k=tt[Math.abs(32*K/W|0)]}g&&(S=z,(f*=y)<0?f=0:f>.1&&(f=.1),A?(V+=(k-z)*f,V*=L):(z=k,V=0),X+=(z+=V)-S,k=X*=1-u),T&&(Q[Z%1024]=k,k+=Q[(Z-C+1024)%1024],Z++),j+=k}j*=.125*U*I,e[it]=j>=1?32767:j<=-1?-32768:32767*j|0}return _}};window.jsfxr=function(t){s._params.setSettings(t);var i=s.totalReset(),e=new Uint8Array(4*((i+1)/2|0)+44),h=2*s.synthWave(new Uint16Array(e.buffer,44),i),r=new Uint32Array(e.buffer,0,44);r[0]=1179011410,r[1]=h+36,r[2]=1163280727,r[3]=544501094,r[4]=16,r[5]=65537,r[6]=44100,r[7]=88200,r[8]=1048578,r[9]=1635017060,r[10]=h,h+=44;for(var a=0,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="data:audio/wav;base64,";a<h;a+=3){var l=e[a]<<16|e[a+1]<<8|e[a+2];o+=n[l>>18]+n[l>>12&63]+n[l>>6&63]+n[63&l]}return o}},function(t,i,e){"use strict";e.r(i);let s,h,r={};function a(t,...i){r[t]&&r[t].map(t=>t(...i))}function n(){return s}function o(){return h}function l(t){if(!(s=document.getElementById(t)||t||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return(h=s.getContext("2d")).imageSmoothingEnabled=!1,a("init"),{canvas:s,context:h}}class c{constructor({spriteSheet:t,frames:i,frameRate:e,loop:s=!0}={}){this.spriteSheet=t,this.frames=i,this.frameRate=e,this.loop=s;let{width:h,height:r,margin:a=0}=t.frame;this.width=h,this.height=r,this.margin=a,this._f=0,this._a=0}clone(){return E(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:i,width:e=this.width,height:s=this.height,context:h=o()}={}){let r=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,a*this.width+(2*a+1)*this.margin,r*this.height+(2*r+1)*this.margin,this.width,this.height,t,i,e,s)}}function E(t){return new c(t)}E.prototype=c.prototype,E.class=c;new WeakMap;const d=()=>{};function _(){let t=n();o().clearRect(0,0,t.width,t.height)}function m({fps:t=60,clearCanvas:i=!0,update:e,render:s}={}){if(!e||!s)throw Error("You must provide update() and render() functions");let h,r,n,o,l,c=0,E=1e3/t,m=1/t,g=i?_:d;function u(){if(r=requestAnimationFrame(u),n=performance.now(),o=n-h,h=n,!(o>1e3)){for(a("tick"),c+=o;c>=E;)l.update(m),c-=E;g(),l.render()}}return l={update:e,render:s,isStopped:!0,start(){h=performance.now(),this.isStopped=!1,requestAnimationFrame(u)},stop(){this.isStopped=!0,cancelAnimationFrame(r)},_frame:u,set _last(t){h=t}}}let g={},u={},p={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};function f(t){let i=p[t.which];u[i]=!0,g[i]&&g[i](t)}function y(t){u[p[t.which]]=!1}function A(){u={}}function I(){let t;for(t=0;t<26;t++)p[65+t]=(10+t).toString(36);for(t=0;t<10;t++)p[48+t]=""+t;window.addEventListener("keydown",f),window.addEventListener("keyup",y),window.addEventListener("blur",A)}function R(t){return!!u[t]}class T{constructor({create:t,maxSize:i=1024}={}){let e;if(!t||!(e=t())||!(e.update&&e.init&&e.isAlive))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");this._c=t,this._i=0,this.objects=[t()],this.size=1,this.maxSize=i}get(t={}){if(this.objects.length==this._i){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.unshift(this._c());this.size=this.objects.length}let i=this.objects.shift();return i.init(t),this.objects.push(i),this._i++,i}getAliveObjects(){return this.objects.slice(this.objects.length-this._i)}clear(){this._i=this.objects.length=0,this.size=1,this.objects.push(this._c())}update(t){let i,e=this.size-1,s=Math.max(this.objects.length-this._i,0);for(;e>=s;)(i=this.objects[e]).update(t),i.isAlive()?e--:(this.objects=this.objects.splice(e,1).concat(this.objects),this._i--,s++)}render(){let t=Math.max(this.objects.length-this._i,0);for(let i=this.size-1;i>=t;i--)this.objects[i].render()}}function N(t){return new T(t)}function M(t,i){let e=[],s=i.x+i.width/2,h=i.y+i.height/2,r=t.y<h&&t.y+t.height>=i.y,a=t.y+t.height>=h&&t.y<i.y+i.height;return t.x<s&&t.x+t.width>=i.x&&(r&&e.push(0),a&&e.push(2)),t.x+t.width>=s&&t.x<i.x+i.width&&(r&&e.push(1),a&&e.push(3)),e}N.prototype=T.prototype,N.class=T;class w{constructor({maxDepth:t=3,maxObjects:i=25,bounds:e}={}){this.maxDepth=t,this.maxObjects=i;let s=n();this.bounds=e||{x:0,y:0,width:s.width,height:s.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map(function(t){t.clear()}),this._b=!1,this._o.length=0}get(t){let i,e,s=new Set;for(;this._s.length&&this._b;){for(i=M(t,this.bounds),e=0;e<i.length;e++)this._s[i[e]].get(t).forEach(t=>s.add(t));return Array.from(s)}return this._o.filter(i=>i!==t)}add(){let t,i,e,s;for(i=0;i<arguments.length;i++)if(e=arguments[i],Array.isArray(e))this.add.apply(this,e);else if(this._b)this._a(e);else if(this._o.push(e),this._o.length>this.maxObjects&&this._d<this.maxDepth){for(this._sp(),t=0;s=this._o[t];t++)this._a(s);this._o.length=0}}_a(t,i,e){for(i=M(t,this.bounds),e=0;e<i.length;e++)this._s[i[e]].add(t)}_sp(t,i,e){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,i=this.bounds.height/2|0,e=0;e<4;e++)this._s[e]=x({bounds:{x:this.bounds.x+(e%2==1?t:0),y:this.bounds.y+(e>=2?i:0),width:t,height:i},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[e]._d=this._d+1,this._s[e]._p=this}}function x(t){return new w(t)}x.prototype=w.prototype,x.class=w;class D{constructor(t=0,i=0){this._x=t,this._y=i}add(t,i=1){return O(this.x+(t.x||0)*i,this.y+(t.y||0)*i,this)}clamp(t,i,e,s){this._c=!0,this._a=t,this._b=i,this._d=e,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function O(t,i,e={}){let s=new D(t,i);return e._c&&(s.clamp(e._a,e._b,e._d,e._e),s.x=t,s.y=i),s}O.prototype=D.prototype,O.class=D;class H{constructor(t){this.init(t)}init(t={}){let{x:i,y:e,dx:s,dy:h,ddx:r,ddy:a,width:n,height:l,image:c}=t;this.position=O(i,e),this.velocity=O(s,h),this.acceleration=O(r,a),this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=o();for(let i in t)this[i]=t[i];c&&(this.width=void 0!==n?n:c.width,this.height=void 0!==l?l:c.height),this.sx=0,this.sy=0}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}get viewX(){return this.x-this.sx}get viewY(){return this.y-this.sy}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let i,e;for(i in this._a={},t)this._a[i]=t[i].clone(),e=e||this._a[i];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}set viewX(t){}set viewY(t){}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let i=this.x-this.width*this.anchor.x,e=this.y-this.height*this.anchor.y,s=t.x,h=t.y;return t.anchor&&(s-=t.width*t.anchor.x,h-=t.height*t.anchor.y),i<s+t.width&&i+this.width>s&&e<h+t.height&&e+this.height>h}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,i=-this.height*this.anchor.y;this.context.save(),this.context.translate(this.viewX,this.viewY),this.width<0&&this.context.scale(-1,1),this.rotation&&this.context.rotate(this.rotation),this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,i,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:i,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,i,this.width,this.height)),this.context.restore()}}function b(t){return new H(t)}function v(t){if(+t===t)return t;let i=[],e=t.split(".."),s=+e[0],h=+e[1],r=s;if(s<h)for(;r<=h;r++)i.push(r);else for(;r>=h;r--)i.push(r);return i}b.prototype=H.prototype,b.class=H;class G{constructor({image:t,frameWidth:i,frameHeight:e,frameMargin:s,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:e,margin:s},this._f=t.width/i|0,this.createAnimations(h)}createAnimations(t){let i,e;for(e in t){let{frames:s,frameRate:h,loop:r}=t[e];if(i=[],void 0===s)throw Error("Animation "+e+" must provide a frames property");[].concat(s).map(t=>{i=i.concat(v(t))}),this.animations[e]=E({spriteSheet:this,frames:i,frameRate:h,loop:r})}}}function P(t){return new G(t)}P.prototype=G.prototype,P.class=G;e(0);const L=[3,.41,.19,.09,.54,.3675,,-.2497,,,,,,,,,.4074,-.0065,1,,,,,.5],S=[0,,.038,.5987,.4229,.8043,,,,,,.5084,.6852,,,,,,1,,,,,.5],W=[3,.25,.54,.2,.84,.47,,1,,,,,,,,,.58,,1,,,,,.5],C=[3,,.42,.2,.84,.43,,-.4399,,,,,,,,.2,.76,,1,,,,,.5],Y=[3,.07,.18,,.25,.68,,-.48,,,,,,,,,,,1,,,,,.5];function k(t){const i=new Audio;i.src=jsfxr(t),i.play()}var j={blast:()=>{k(L)},upgrade:()=>{k(S)},gameOver:()=>{k(C)},gameStartAndBeaten:()=>{k(W)},playerHit:()=>{k(Y)}};class F{constructor(t){this.canvas=t,l(t.id),I(),this.FPS=60,this.WIDTH=t.width,this.HEIGHT=t.height,this.FLOOR=.8*this.HEIGHT,this.SKY_COLOR="rgba(0, 0, 0, 1)",this.SKY_COLOR_REAL="rgba(180, 180, 180, 1)",this.PLAYER_WIDTH=this.WIDTH/16,this.PLAYER_HEIGHT=2*this.PLAYER_WIDTH,this.PLAYER_HP=255,this.PLAYER_SPEED=this.WIDTH/200,this.PLAYER_HIT_DURATION=.5,this.GRENADE_WIDTH=this.WIDTH/64,this.GRENADE_HEIGHT=this.GRENADE_WIDTH,this.GRENADE_COLOR="rgba(255, 255, 255, 1)",this.GRENADE_THROW_RANGE=this.WIDTH/4,this.GRENADE_THROW_DURATION=.5,this.GRENADE_BLAST_RANGE=this.WIDTH/4,this.GRENADE_BLAST_DURATION=.2,this.GRENADE_COOLDOWN=.2,this.GRENADE_REGENERATE=2,this.GRENADE_ATTACK=100,this.GRENADE_PROGRESS=2,this.GRENADE_CAPACITY=3,this.MINE_WIDTH=this.WIDTH/32,this.MINE_HEIGHT=this.MINE_WIDTH/2,this.MINE_COLOR="rgba(255, 255, 255, 1)",this.MINE_BLAST_RANGE=this.WIDTH/3,this.MINE_BLAST_DURATION=.5,this.MINE_COOLDOWN=.5,this.MINE_REGENERATE=5,this.MINE_ATTACK=150,this.MINE_PROGRESS=4,this.MINE_CAPACITY=1,this.ENEMY_WIDTH_MIN=.5*this.PLAYER_WIDTH,this.ENEMY_WIDTH_MAX=2*this.PLAYER_WIDTH,this.ENEMY_HEIGHT_MIN=.5*this.PLAYER_HEIGHT,this.ENEMY_HEIGHT_MAX=2*this.PLAYER_HEIGHT,this.ENEMY_COLOR_LIGHT="rgba(230, 230, 230, 1)",this.ENEMY_SPEED=this.WIDTH/400,this.ENEMY_ATTACK=30,this.WAVE_ENEMY_COUNT=10,this.WAVE_INTERVAL=3e3,this.UI_FONT_SIZE=this.WIDTH/60,this.TREE_MIN_WIDTH=this.WIDTH/10,this.TREE_MIN_HEIGHT=this.FLOOR/3,this.TREE_MAX_WIDTH=this.WIDTH/4,this.TREE_MAX_HEIGHT=.9*this.FLOOR,this.TREE_MIN_INTERVAL=.2,this.TREE_MAX_INTERVAL=1.5,this.UPGRADES=[{msg:"Flash Bang Capacity ↑",func:()=>{this.GRENADE_CAPACITY+=1},weight:15},{msg:"Flash Bang Blast Range ↑",func:()=>{this.GRENADE_BLAST_RANGE+=this.WIDTH/100},weight:20},{msg:"Flash Bang Damage ↑",func:()=>{this.GRENADE_ATTACK+=10},weight:20},{msg:"Flash Bang Regenerate ↑",func:()=>{this.GRENADE_REGENERATE-=.1},weight:20},{msg:"Flash Mine Capacity ↑",func:()=>{this.MINE_CAPACITY+=1},weight:5},{msg:"Flash Mine Blast Range ↑",func:()=>{this.MINE_BLAST_RANGE+=this.WIDTH/100},weight:20},{msg:"Flash Mine Damage ↑",func:()=>{this.MINE_ATTACK+=20},weight:20},{msg:"Flash Mine Regenerate ↑",func:()=>{this.MINE_REGENERATE-=.2},weight:20},{msg:"Running Speed ↑",func:()=>{this.ENEMY_SPEED-=this.WIDTH/8e3},weight:15}],this.UPGRADE_KILL_INTERVAL=15,this.timeInMill=0,this.gameProgress=0,this.message="",this.messageDuration=0,this.kills=0,this.blasting_duration=0,this.total_blast_duration=0,this.playerHitTimer=0,this.enemyMinHp=50,this.enemyMaxHp=100,this.treeInterval=Math.random()*(this.TREE_MAX_INTERVAL-this.TREE_MIN_INTERVAL)+this.TREE_MIN_INTERVAL,this.player=this.initPlayer(),this.enemyPool=N({create:b}),this.grenades=this.GRENADE_CAPACITY,this.grenadeCD=this.GRENADE_COOLDOWN,this.grenadeReg=0,this.grenadePool=N({create:b}),this.mines=this.MINE_CAPACITY,this.mineCD=this.MINE_COOLDOWN,this.mineReg=0,this.minePool=N({create:b}),this.blastPool=N({create:b}),this.treePool=N({create:b}),this.ui=this.initUI(),this.loop=m({update:t=>{if(this.gameProgress>=255)return this.loop.stop(),void this.onGameBeaten();if(this.player.hp<=0)return this.loop.stop(),void this.onGameOver();if(this.timeInMill=Math.round(this.timeInMill+1e3*t),this.updateTrees(),this.updatePlayer(t),this.updateEnemies(),this.updateGrenades(t),this.updateMines(),this.updateBlast(t),this.updateUI(),this.blasting_duration>=this.total_blast_duration?this.blasting_duration=this.total_blast_duration=0:this.blasting_duration+=t,this.blasting_duration<this.total_blast_duration?this.canvas.style.background=this.SKY_COLOR_REAL:this.canvas.style.background=`rgba(${this.gameProgress}, ${this.gameProgress}, ${this.gameProgress}, 1)`,this.treeInterval<=0?(this.makeTree(),this.treeInterval=Math.random()*(this.TREE_MAX_INTERVAL-this.TREE_MIN_INTERVAL)+this.TREE_MIN_INTERVAL):this.treeInterval-=t,this.messageDuration>0?this.messageDuration-=t:this.messageDuration=0,this.grenades<this.GRENADE_CAPACITY&&(this.grenadeReg<this.GRENADE_REGENERATE?this.grenadeReg+=t:(this.grenades+=1,this.grenadeReg=0)),this.grenadeCD+=t,R("z")&&this.grenadeCD>=this.GRENADE_COOLDOWN&&(this.makeGrenade(),this.grenadeCD=0),this.mines<this.MINE_CAPACITY&&(this.mineReg<this.MINE_REGENERATE?this.mineReg+=t:(this.mines+=1,this.mineReg=0)),this.mineCD+=t,R("x")&&this.mineCD>=this.MINE_COOLDOWN&&(this.makeMine(),this.mineCD=0),this.blastPool.getAliveObjects().forEach(t=>{this.enemyPool.getAliveObjects().forEach(i=>{if(t.collidesWith(i)&&i.blastId!==t.id){let e="g"===t.type?this.GRENADE_ATTACK:this.MINE_ATTACK;i.hp-=e,i.blastId=t.id,i.hp<=0&&(i.ttl=0,this.kills++,this.kills%this.UPGRADE_KILL_INTERVAL==0&&this.randomUpgrade())}})}),this.minePool.getAliveObjects().forEach(t=>{let i=!1;for(let e of this.enemyPool.getAliveObjects())if(t.collidesWith(e)){i=!0;break}i&&(t.ttl=0,this.total_blast_duration+=this.MINE_BLAST_DURATION,this.makeBlast("m",t.x))}),0===this.playerHitTimer){let t=!1;this.enemyPool.getAliveObjects().forEach(i=>{i.collidesWith(this.player)&&(t=!0)}),t&&(j.playerHit(),this.player.hp-=this.ENEMY_ATTACK,this.playerHitTimer+=.01)}else this.playerHitTimer>=this.PLAYER_HIT_DURATION?this.playerHitTimer=0:this.playerHitTimer+=t},render:()=>{this.treePool.render(),this.ui.render(),this.player.render(),this.enemyPool.render(),this.grenadePool.render(),this.minePool.render(),this.blastPool.render()}})}start(){this.enemyInterval=setInterval(()=>{this.makeEnemies(this.WAVE_ENEMY_COUNT)},this.WAVE_INTERVAL),this.loop.start()}collidesWith(t){return Math.abs(this.x-t.x)<=(this.width+t.width)/2}initPlayer(){return b({anchor:{x:.5,y:1},x:this.WIDTH/4*3,y:this.FLOOR,dy:-1,width:this.PLAYER_WIDTH,height:this.PLAYER_HEIGHT,color:`rgba(${this.PLAYER_HP}, ${this.PLAYER_HP}, ${this.PLAYER_HP}, 1)`,collidesWith:this.collidesWith,hp:this.PLAYER_HP})}updatePlayer(t){const i=this.player;i.hp<=0?i.rotation=Math.PI/2:(i.rotation=Math.PI/12,i.y+=i.dy,(i.y<this.FLOOR-20||i.y>this.FLOOR)&&(i.dy=-i.dy),i.color=`rgba(${i.hp}, ${i.hp}, ${i.hp}, 1)`)}makeEnemies(t){for(let i=0;i<t;i++){const t=(this.enemyMaxHp-this.enemyMinHp)*Math.random()+this.enemyMinHp,i=`rgba(${255-t}, ${255-t}, ${255-t}, 1)`;this.enemyPool.get({anchor:{x:.5,y:1},x:-Math.random()*this.ENEMY_WIDTH_MIN*16,y:this.FLOOR-20*Math.random(),width:t/255*(this.ENEMY_WIDTH_MAX-this.ENEMY_WIDTH_MIN)+this.ENEMY_WIDTH_MIN,height:t/255*(this.ENEMY_HEIGHT_MAX-this.ENEMY_HEIGHT_MIN)+this.ENEMY_HEIGHT_MIN,color:i,collidesWith:this.collidesWith,vx:this.ENEMY_SPEED,vy:-1.5,itsColor:i,hp:t,render:function(){const t=this.context;t.fillStyle=this.color,t.fillRect(this.x-this.width/2,this.y-this.height,this.width,this.height),t.fillStyle="rgba(255, 0, 0, 1)",t.fillRect(this.x,this.y-.8*this.height,.4*this.width,.1*this.width)}})}}updateEnemies(){this.enemyPool.getAliveObjects().forEach(t=>{t.rotation=Math.PI/10;let i=255-t.hp;this.blasting_duration<this.total_blast_duration?t.color=this.ENEMY_COLOR_LIGHT:(t.itsColor=`rgba(${i}, ${i}, ${i}, 1)`,t.color=t.itsColor),t.y+=t.vy,(t.y<this.FLOOR-20||t.y>this.FLOOR)&&(t.vy=-t.vy),t.collidesWith(this.player)||(t.x+=t.vx)}),this.enemyPool.update()}makeGrenade(){this.grenades<1||(this.grenadePool.get({anchor:{x:.5,y:1},width:this.GRENADE_WIDTH,height:this.GRENADE_HEIGHT,color:this.GRENADE_COLOR,x:this.player.x,y:this.player.y-this.PLAYER_HEIGHT,deltaX:0,vx:this.GRENADE_THROW_RANGE/this.GRENADE_THROW_DURATION,vy:this.PLAYER_HEIGHT/this.GRENADE_THROW_DURATION}),this.grenades-=1)}updateGrenades(t){this.grenadePool.getAliveObjects().forEach(i=>{i.deltaX>=this.GRENADE_THROW_RANGE?(i.ttl=0,this.total_blast_duration+=this.GRENADE_BLAST_DURATION,this.makeBlast("g",i.x)):(i.x-=i.vx*t,i.y+=i.vy*t,i.deltaX+=i.vx*t)}),this.grenadePool.update()}makeMine(){this.mines<1||(this.minePool.get({anchor:{x:.5,y:1},width:this.MINE_WIDTH,height:this.MINE_HEIGHT,color:this.MINE_COLOR,x:this.player.x,y:this.FLOOR,dx:-this.PLAYER_SPEED,collidesWith:this.collidesWith}),this.mines-=1)}updateMines(){this.minePool.update()}makeBlast(t,i){const e="g"===t?this.GRENADE_BLAST_RANGE:this.MINE_BLAST_RANGE,s="g"===t?this.GRENADE_BLAST_DURATION*this.FPS:this.MINE_BLAST_DURATION*this.FPS;this.blastPool.get({anchor:{x:.5,y:1},width:e,height:this.FLOOR,x:i,y:this.FLOOR,color:this.GRENADE_COLOR,ttl:s,dx:-this.PLAYER_SPEED,collidesWith:this.collidesWith,type:t,id:1e6*Math.random()});const h="g"===t?this.GRENADE_PROGRESS:this.MINE_PROGRESS;this.gameProgress+=h,this.enemyMaxHp<300&&(this.enemyMaxHp+=h),j.blast()}updateBlast(t){this.blastPool.update()}initUI(){const t=this;return b({render:function(){const i=this.context,e=t.gameProgress>130?"rgba(0, 0, 0, 1)":"rgba(255, 255, 255, 1)",s=t.gameProgress-40,h=`rgba(${s}, ${s}, ${s}, 1)`;if(i.fillStyle=h,i.fillRect(0,t.FLOOR,t.WIDTH,t.HEIGHT-t.FLOOR),i.fillStyle=e,i.font=`${t.UI_FONT_SIZE}px Helvetica,Arial`,i.fillText(`FLASH BANGS [Z]: ${t.grenades} / ${t.GRENADE_CAPACITY}`,.05*t.WIDTH,t.FLOOR+2*t.UI_FONT_SIZE),i.fillText(`FLASH MINES [X]: ${t.mines} / ${t.MINE_CAPACITY}`,.05*t.WIDTH,t.FLOOR+4*t.UI_FONT_SIZE),i.fillText(`KILLS: ${t.kills}`,.05*t.WIDTH,2*t.UI_FONT_SIZE),t.messageDuration>0){let e=i.measureText(t.message).width;i.fillText(t.message,t.WIDTH-e-.05*t.WIDTH,t.FLOOR+2*t.UI_FONT_SIZE)}const r=t.formatTime(t.timeInMill);let a=i.measureText(r).width;i.fillText(r,t.WIDTH-a-.05*t.WIDTH,2*t.UI_FONT_SIZE)}})}updateUI(){this.ui.update()}makeTree(){const t=Math.random()*(this.TREE_MAX_WIDTH-this.TREE_MIN_WIDTH)+this.TREE_MIN_WIDTH,i=Math.random()*(this.TREE_MAX_HEIGHT-this.TREE_MIN_HEIGHT)+this.TREE_MIN_HEIGHT,e=100*Math.random()+25,s=e-10;this.treePool.get({anchor:{x:.5,y:1},width:t,height:i,x:this.WIDTH+t,y:this.FLOOR,dx:-this.PLAYER_SPEED,crownRatio:.2*Math.random()+.6,crownGray:e,trunkGray:s,render:function(){const t=this.context;t.fillStyle=`rgba(${this.trunkGray}, ${this.trunkGray}, ${this.trunkGray}, 1)`,t.fillRect(this.x-.4*this.width/2,this.y-(1-this.crownRatio+.15)*this.height,.4*this.width,this.height*(1-this.crownRatio+.15)),t.fillStyle=`rgba(${this.crownGray}, ${this.crownGray}, ${this.crownGray}, 1)`,t.fillRect(this.x-this.width/2,this.y-this.height,this.width,this.height*this.crownRatio)}})}updateTrees(){this.treePool.update()}randomUpgrade(){const t=this.UPGRADES.reduce((t,i)=>t+i.weight,0),i=Math.random();let e=0;for(let s of this.UPGRADES){let h=s.weight/t;if(i>=e&&i<e+h){s.func(),this.showMessage(s.msg);break}e+=h}j.upgrade()}showMessage(t){this.message=t,this.messageDuration=3}formatTime(t){const i=t%1e3,e=(t-i)/1e3%60,s=Math.floor((t-i)/1e3/60);return`${s<10?"0"+s:s}:${e<10?"0"+e:e}:${["00","0",""][Math.floor(Math.log10(i))]+i}`}onGameOver(){}onGameBeaten(){}}const B=document.getElementById("game");B.width=B.parentElement.clientWidth,B.height=B.parentElement.clientHeight;const $=B.width/50,U=document.getElementsByTagName("span");for(let t=0;t<U.length;t++)U[t].style.fontSize=$+"px";const X=document.getElementById("new-game"),V=document.getElementById("game-over"),z=document.getElementById("game-beaten");X.style.opacity=1,document.addEventListener("keypress",function t(i){if("z"===i.key){(K=new F(B)).onGameOver=()=>{Z(V,!0,j.gameOver,()=>{K=null,document.addEventListener("keypress",t)})},K.onGameBeaten=()=>{Z(z,!0,j.gameStartAndBeaten,()=>{!function(t){const i=JSON.parse(localStorage.getItem("dawn-breaker-rank"))||[];i.push({name:"",time:t}),i.sort((t,i)=>t.time<i.time?-1:1),i.length>5&&i.pop();let e=!1;if(i.map(t=>{""===t.name&&(e=!0)}),e){let t="";for(;""===t;)t=prompt("High Score!\nEnter your name to show in rank list:");i.map(i=>{i.name=""===i.name?t:i.name}),localStorage.setItem("dawn-breaker-rank",JSON.stringify(i));let e=i.map((t,i)=>`${i+1}\t\t${t.name}\t\t${t.time/1e3}`).join("\n");e="Rank List\nrank\t\tname\t\ttime(s)\n"+e,alert(e)}}(K.timeInMill),K=null,document.addEventListener("keypress",t)})},Z("1"===X.style.opacity?X:"1"===V.style.opacity?V:z,!1,j.gameStartAndBeaten,()=>{K.start(),document.removeEventListener("keypress",t)})}});let K=null;function Z(t,i,e,s){e();const h=setInterval(()=>{t.style.opacity-=100*(i?-1:1)/2e3,(i&&parseFloat(t.style.opacity)>=1||!i&&parseFloat(t.style.opacity)<=0)&&(clearInterval(h),s())},100)}}]);