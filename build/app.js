var directions={UP:"up",DOWN:"down",RIGHT:"right",LEFT:"left",BACK:"back",ALL:["up","down","left","right"]},modes=["Braille","Visual Morse","Morse"];let Interactable=function(e,t,i){this.g=e,this.active=!1,this.action=t||{},this.stop=i||{}};Interactable.prototype.activate=function(){this.active||(this.active=!0,this.action())},Interactable.prototype.deactivate=function(){this.active=!1,this.stop()};let n="C3",dot=1,dash=3,spaceNote="-",spaceLen=7,el=3,Morse={a:[{n:n,len:dot},{n:n,len:dash}],b:[{n:n,len:dash},{n:n,len:dot},{n:n,len:dot},{n:n,len:dot}],c:[{n:n,len:dash},{n:n,len:dot},{n:n,len:dash},{n:n,len:dot}],d:[{n:n,len:dash},{n:n,len:dot},{n:n,len:dot}],e:[{n:n,len:dot}],f:[{n:n,len:dot},{n:n,len:dot},{n:n,len:dash},{n:n,len:dot}],g:[{n:n,len:dash},{n:n,len:dash},{n:n,len:dot}],h:[{n:n,len:dot},{n:n,len:dot},{n:n,len:dot},{n:n,len:dot}],i:[{n:n,len:dot},{n:n,len:dot}],j:[{n:n,len:dot},{n:n,len:dash},{n:n,len:dash},{n:n,len:dash}],k:[{n:n,len:dash},{n:n,len:dot},{n:n,len:dash}],l:[{n:n,len:dot},{n:n,len:dash},{n:n,len:dot},{n:n,len:dot}],m:[{n:n,len:dash},{n:n,len:dash}],n:[{n:n,len:dash},{n:n,len:dot}],o:[{n:n,len:dash},{n:n,len:dash},{n:n,len:dash}],p:[{n:n,len:dot},{n:n,len:dash},{n:n,len:dash},{n:n,len:dot}],q:[{n:n,len:dash},{n:n,len:dash},{n:n,len:dot},{n:n,len:dash}],r:[{n:n,len:dot},{n:n,len:dash},{n:n,len:dot}],s:[{n:n,len:dot},{n:n,len:dot},{n:n,len:dot}],t:[{n:n,len:dash}],u:[{n:n,len:dot},{n:n,len:dot},{n:n,len:dash}],v:[{n:n,len:dot},{n:n,len:dot},{n:n,len:dot},{n:n,len:dash}],w:[{n:n,len:dot},{n:n,len:dash},{n:n,len:dash}],x:[{n:n,len:dash},{n:n,len:dot},{n:n,len:dot},{n:n,len:dash}],y:[{n:n,len:dash},{n:n,len:dot},{n:n,len:dash},{n:n,len:dash}],z:[{n:n,len:dash},{n:n,len:dash},{n:n,len:dot},{n:n,len:dot}],period:[{n:n,len:dot},{n:n,len:dash},{n:n,len:dot},{n:n,len:dash},{n:n,len:dot},{n:n,len:dash}],comma:[{n:n,len:dash},{n:n,len:dash},{n:n,len:dot},{n:n,len:dot},{n:n,len:dash},{n:n,len:dash}],question:[{n:n,len:dot},{n:n,len:dot},{n:n,len:dash},{n:n,len:dash},{n:n,len:dot},{n:n,len:dot}],exclamation:[{n:n,len:dash},{n:n,len:dot},{n:n,len:dash},{n:n,len:dot},{n:n,len:dash},{n:n,len:dash}],space:[{n:spaceNote,len:spaceLen}],endL:[{n:spaceNote,len:el}]};function characterToMorse(e){switch(e){case" ":return Morse.space;case".":return Morse.period;case",":return Morse.comma;case"?":return Morse.question;case"!":return Morse.exclamation;default:return Morse[e]}}let MorseActions={toMorse:function(e){let t=[];return e.split(" ").forEach(e=>{for(let i=0;i<e.length;i++)t.push({ch:e[i],code:characterToMorse(e[i])}),t.push({ch:"|",code:Morse.endL});t.pop(),t.push({ch:" ",code:characterToMorse(" ")})}),t}};var enharmonics="B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb",middleC=440*Math.pow(Math.pow(2,1/12),-9),numeric=/^[0-9.]+$/,octaveOffset=4,space=/\s+/,num=/(\d+)/,offsets={};function Note(e){var t=e.split(space);this.frequency=Note.getFrequency(t[0])||0,this.duration=Note.getDuration(t[1])||0}function Sequence(e,t,i){this.ac=e||new AudioContext,this.createFxNodes(),this.tempo=t||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,i||[])}enharmonics.split("|").forEach((function(e,t){e.split("-").forEach((function(e){offsets[e]=t}))})),Note.getFrequency=function(e){var t=e.split(num),i=offsets[t[0]],s=(t[1]||octaveOffset)-octaveOffset;return middleC*Math.pow(Math.pow(2,1/12),i)*Math.pow(2,s)},Note.getDuration=function(e){return numeric.test(e)?parseFloat(e):e.toLowerCase().split("").reduce((function(e,t){return e+("w"===t?4:"h"===t?2:"q"===t?1:"e"===t?.5:"s"===t?.25:0)}),0)},Sequence.prototype.createFxNodes=function(){var e=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(t,i){(i=this[t[0]]=this.ac.createBiquadFilter()).type="peaking",i.frequency.value=t[1],e.connect(e=i)}.bind(this)),e.connect(this.ac.destination),this},Sequence.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(e){this.notes.push(e instanceof Note?e:new Note(e))}.bind(this)),this},Sequence.prototype.createCustomWave=function(e,t){t||(t=e),this.waveType="custom",this.customWave=[new Float32Array(e),new Float32Array(t)]},Sequence.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},Sequence.prototype.scheduleNote=function(e,t){var i=60/this.tempo*this.notes[e].duration,s=i*(1-(this.staccato||0));return this.setFrequency(this.notes[e].frequency,t),this.smoothing&&this.notes[e].frequency&&this.slide(e,t,s),this.setFrequency(0,t+s),t+i},Sequence.prototype.getNextNote=function(e){return this.notes[e<this.notes.length-1?e+1:0]},Sequence.prototype.getSlideStartDelay=function(e){return e-Math.min(e,60/this.tempo*this.smoothing)},Sequence.prototype.slide=function(e,t,i){var s=this.getNextNote(e),n=this.getSlideStartDelay(i);return this.setFrequency(this.notes[e].frequency,t+n),this.rampFrequency(s.frequency,t+i),this},Sequence.prototype.setFrequency=function(e,t){return this.osc.frequency.setValueAtTime(e,t),this},Sequence.prototype.rampFrequency=function(e,t){return this.osc.frequency.linearRampToValueAtTime(e,t),this},Sequence.prototype.play=function(e){return e="number"==typeof e?e:this.ac.currentTime,this.createOscillator(),this.osc.start(e),this.notes.forEach(function(t,i){e=this.scheduleNote(i,e)}.bind(this)),this.osc.stop(e),this.osc.onended=this.loop?this.play.bind(this,e):null,this},Sequence.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this};var ac=new AudioContext,tempo=120,sequence=new Sequence(ac,tempo,["G3 q","E4 q","C4 h"]);sequence.loop=!1;var ac$1=new AudioContext;let currentSequence,generateSequence=function(e,t){let i=[];e.map(e=>{i.push(`${e.n} ${e.len}`)});let s=new Sequence(ac$1,t,i);return s.loop=!1,s.staccato=.5,s.gain.gain.value=.5,s.createCustomWave([-.8,1,.8,.8,-.8,-.8,-1]),s},MusicActions={playMusic:function(e,t,i){currentSequence&&currentSequence.stop(),(currentSequence=generateSequence(e,t)).play(ac$1.currentTime+60/t)},stopMusic:function(){currentSequence&&currentSequence.stop()}},Braille={a:[1,0,0,0,0,0],b:[1,0,1,0,0,0],c:[1,1,0,0,0,0],d:[1,1,0,1,0,0],e:[1,0,0,1,0,0],f:[1,1,1,0,0,0],g:[1,1,1,1,0,0],h:[1,0,1,1,0,0],i:[0,1,1,0,0,0],j:[0,1,1,1,0,0],k:[1,0,0,0,1,0],l:[1,0,1,0,1,0],m:[1,1,0,0,1,0],n:[1,1,0,1,1,0],o:[1,0,0,1,1,0],p:[1,1,1,0,1,0],q:[1,1,1,1,1,0],r:[1,0,1,1,1,0],s:[0,1,1,0,1,0],t:[0,1,1,1,1,0],u:[1,0,0,0,1,1],v:[1,0,1,0,1,1],w:[0,1,1,1,0,1],x:[1,1,0,0,1,1],y:[1,1,0,1,1,1],z:[1,0,0,1,1,1],space:[0,0,0,0,0,0],exclamation:[0,0,1,1,1,0],comma:[0,0,1,0,0,0],period:[0,0,1,1,0,1],question:[0,0,1,0,1,1]};function characterToBraille(e){switch(e){case" ":return Braille.space;case"!":return Braille.exclamation;case",":return Braille.comma;case".":return Braille.period;case"?":return Braille.question;default:return Braille[e]}}function toBraille(e){let t=[];return e.split(" ").forEach(e=>{for(let i=0;i<e.length;i++)t.push({ch:e[i],dots:characterToBraille(e[i])});t.push({ch:" ",dots:characterToBraille(" ")})}),t}let noteList=[],Statue=function(e,t){Interactable.call(this,e),this.sprite=e.rectangle(48,64,"brown"),this.scene=e.group(),this.sprites=[],this.modal={},this.mode=t};Statue.prototype=Object.create(Interactable.prototype),Statue.prototype.initialize=function(e,t){this.mode===modes[0]?(this.action=()=>this.showBraille(toBraille(e),this.scene,t),this.stop=this.closeModal):this.mode===modes[1]?(this.action=()=>this.showMorse(MorseActions.toMorse(e),this.scene,t),this.stop=this.closeModal):(noteList=[],this.action=()=>this.playMorse(MorseActions.toMorse(e)),this.stop=this.stopMorse)},Statue.prototype.stopMorse=function(){MusicActions.stopMusic(),this.closeModal()},Statue.prototype.closeModal=function(){this.g.remove(this.modal),this.g.remove(this.sprites)},Statue.prototype.playMorse=function(e){let t=this.g.canvas.width;this.modal=this.g.rectangle(t/2,this.g.canvas.height/10,"teal","black",1,t/4,this.g.canvas.height/10),this.sprites=[this.g.text("Playing morse","30px Times","black",0,0)],this.scene.addChild(this.modal),this.modal.putLeft(this.sprites[0],t/5,-10);let i=[];0===noteList.length?(e.map((e,t)=>{e.code.map(e=>{i.push({n:e.n,len:e.len})})}),noteList=i):i=noteList,MusicActions.playMusic(i,this.g.globals.GAME_TEMPO)},Statue.prototype.showMorse=function(e,t,i=!1){let s=30,n=this.g.canvas.height/10,r=n,a=[],o=2,h=this.g.canvas.width-30,l="";i&&(l=e[0].ch),e.map(e=>{if(30*e.code.length+s>=h&&(s=30,r+=20,o++),e.ch===l){let e=this.g.text(l,"20px Times","yellow",s,r-5);a.push(e),s+=15}else e.code.map((t,i)=>{1===t.len?(a.push(this.g.circle(10,"black","black",1,s,r)),s+=15):3===t.len&&"|"!==e.ch?(a.push(this.g.rectangle(30,10,"black","black",1,s,r)),s+=35):"|"===e.ch?(a.push(this.g.rectangle(1,10,"red","red",1,s,r)),s+=6):7===t.len&&(a.push(this.g.rectangle(30,.5,"red","red",1,s,r+5)),s+=35)})}),this.modal=this.g.rectangle(h,10*o*2,"teal","black",1,15,n-10),this.sprites=a,t.addChild(this.modal),t.add(a)},Statue.prototype.showBraille=function(e,t,i=!1){let s=15,n=this.g.canvas.height/10,r=n,a=[],o=2,h=this.g.canvas.width-15,l="";i&&(l=e[0].ch),e.map(e=>{if(30+s>=h&&(s=15,r+=50,o++),e.ch===l){let e=this.g.text(l,"40px Times","yellow",s+5,r);a.push(e)}else e.dots.map((e,t)=>{let i=s+t%2*15,n=r+15*Math.floor(t/2);a.push(this.g.circle(10,1===e?"black":"teal","black",1,i,n))});s+=35}),this.sprites=a,this.modal=this.g.rectangle(h,15*o*3,"teal","black",1,7.5,n-15),t.addChild(this.modal),t.add(a)};let Pit=function(e,t){let i=0,s=0;t===directions.UP?(i=e.canvas.width/2-18,s=0):t===directions.DOWN?(i=e.canvas.width/2-18,s=e.canvas.height-36):t===directions.LEFT?(i=0,s=e.canvas.height/2-18):t===directions.RIGHT&&(i=e.canvas.width-36,s=e.canvas.height/2-18),this.sprite=e.rectangle(36,36,"black","black",1,i,s),this.dir=t},StatueRoom=function(e,t,i){this.g=e,this.player=e.globals.player,this.loadNext=i,this.mode=t,this.statue=new Statue(e,t),this.canUseStatue=!1,this.pits=[new Pit(e,directions.UP),new Pit(e,directions.DOWN),new Pit(e,directions.LEFT),new Pit(e,directions.RIGHT)],e.stage.putCenter(this.statue.sprite),this.pitSprites=this.pits.map(e=>e.sprite),this.scene=e.group(this.statue.sprite,this.pitSprites[0],this.pitSprites[1],this.pitSprites[2],this.pitSprites[3]),this.scene.visible=!1,this.actionKey=e.keyboard(70),this.cancelKey=e.keyboard(68),this.actionKey.press=()=>{this.canUseStatue&&!this.statue.active&&(this.scene.alpha=.1,this.player.sprite.alpha=.1,this.statue.activate())},this.cancelKey.press=()=>{this.statue.active&&(this.scene.alpha=1,this.player.sprite.alpha=1,this.statue.deactivate())}};StatueRoom.prototype.load=function(e,t){this.statue.initialize(e.toLowerCase(),t),this.g.stage.putCenter(this.player.sprite,0,100)},StatueRoom.prototype.placePlayer=function(e){let t,i,s=this.pitSprites[0].width;e===directions.UP?(i=2*s-this.g.canvas.height/2,t=0):e===directions.DOWN?(t=0,i=this.g.canvas.height/2-2*s):e===directions.LEFT?(t=2*s-this.g.canvas.width/2,i=0):e===directions.RIGHT&&(t=this.g.canvas.width/2-2*s,i=0),this.g.stage.putCenter(this.player.sprite,t,i)},StatueRoom.prototype.loop=function(){this.statue.active||this.g.move(this.player.sprite),this.g.contain(this.player.sprite,this.g.stage.localBounds),this.g.rectangleCollision(this.player.sprite,this.statue.sprite)&&this.player.sprite.direction===directions.UP&&(this.canUseStatue=!0),this.player.sprite.direction!==directions.UP&&(this.canUseStatue=!1),this.pits.forEach(e=>{this.g.hitTestRectangle(this.player.sprite,e.sprite)&&this.loadNext(e.dir)})};let Spikes=function(e,t){let i,s,n,r;t===directions.UP?(s=0,i=0,n=e.canvas.width,r=36):t===directions.DOWN?(i=0,s=e.canvas.height-36,n=e.canvas.width,r=36):t===directions.LEFT?(i=0,s=0,n=36,r=e.canvas.height):t===directions.RIGHT&&(i=e.canvas.width-36,s=0,n=36,r=e.canvas.height),this.sprite=e.rectangle(n,r,"grey","grey",1,i,s),this.sprite.alpha=.5,this.side=t},Actor=function(e,t,i,s){this.g=e,this.health=t,this.invincible=!1,this.invinceTime=i||1e3,this.dead=!1,this.healthWidth=s,this.healthSprite=e.rectangle(this.healthWidth*this.health,this.healthWidth,"purple"),this.healthSprite.visible=!1,this.healthSprite.alpha=.5};Actor.prototype.show=function(){this.sprite.visible=!0,this.healthSprite.visible=!0},Actor.prototype.hide=function(){this.sprite.visible=!1,this.healthSprite.visible=!1},Actor.prototype.stopMoving=function(){this.sprite.vx=0,this.sprite.vy=0},Actor.prototype.heal=function(e){this.health+=e,this.healthSprite.width+=this.healthWidth*e},Actor.prototype.takeDamage=function(e,t){if(this.invincible)return;if(this.health-=e,this.health<=0)return this.dead=!0,void(this.healthSprite.width=0);this.invincible=!0,this.sprite.alpha=.5,this.healthSprite.width-=this.healthWidth*e;switch(this.loseInvincibility(this.invinceTime),t){case"right":this.sprite.x-=40;break;case"left":this.sprite.x+=40;break;case"up":this.sprite.y+=40;break;case"down":this.sprite.y-=40}},Actor.prototype.loseInvincibility=function(e){this.g.wait(e,()=>{this.invincible=!1,this.sprite.alpha=1})},Actor.prototype.moveHealth=function(){this.healthSprite.x=this.sprite.x,this.healthSprite.y=this.sprite.y-this.healthWidth};let Enemy=function(e,t){this.sprite=e.rectangle(32,32,"red"),Actor.call(this,e,t,500,10),this.damage=1,this.speed=1,this.show()};Enemy.prototype=Object.create(Actor.prototype);const getRand=function(e){return Math.floor(Math.random()*Math.abs(e))},toRadians=function(e){return e*(Math.PI/180)},reverseDirection=function(e){switch(e){case directions.RIGHT:return directions.LEFT;case directions.LEFT:return directions.RIGHT;case directions.UP:return directions.DOWN;case directions.DOWN:return directions.UP}};let Boss=function(e,t){this.playerSprite=t,this.sprite=e.rectangle(64,64,"red"),Actor.call(this,e,20,400,10),this.sprite.visible=!1,this.healthSprite.visible=!1,this.damage=1.3,this.speed=3,this.boundaryBox=e.rectangle(128,128,"red"),this.boundaryBox.visible=!1,this.g.wait(2*this.invinceTime,()=>this.warp())};Boss.prototype=Object.create(Actor.prototype),Boss.prototype.takeDamage=function(e,t){if(!this.invincible){if(this.health-=e,this.health<=0)return this.dead=!0,void(this.healthSprite.width=0);this.invincible=!0,this.healthSprite.width-=this.healthWidth*e,this.speed=0,this.sprite.alpha=.5,this.g.wait(this.invinceTime,()=>this.delayWarp())}},Boss.prototype.delayWarp=function(){this.sprite.visible=!1,this.healthSprite.visible=!1,this.g.wait(this.invinceTime,()=>this.warp())},Boss.prototype.warp=function(){let e,t,i=this.playerSprite.x,s=this.playerSprite.y,n=this.g.canvas.width/2;do{e=getRand(360),t=this.g.rotateAroundPoint(i,s,n,n,toRadians(e)),this.boundaryBox.x=t.x,this.boundaryBox.y=t.y}while(this.g.hitTestRectangle(this.boundaryBox,this.playerSprite));this.sprite.x=t.x+32,this.sprite.y=t.y+32,this.invincible=!1,this.speed=3,this.sprite.alpha=1,this.show()};class TextUtil{constructor(e){this.g=e}centeredTexts(e,t,i,s,n){const r=this.g,a=.2*t;let o=1===e.length?e[0].length:e.reduce((e,t)=>e.length>t.length?e.length:t.length);return e.map((e,h)=>r.text(e,`${t}px monospace`,i,r.stage.halfWidth-o/2*((t+a)/2),s+n*h))}}let GameOver=function(e,t){new TextUtil(e).centeredTexts(t,40,"black",e.stage.halfHeight-40*(t.length-1),40);return()=>{}},EnemyRoom=function(e,t){this.g=e,this.player=e.globals.player,this.exitPit=e.rectangle(50,50,"yellow"),this.loadNext=t,this.spikes=[new Spikes(e,directions.UP),new Spikes(e,directions.DOWN),new Spikes(e,directions.LEFT),new Spikes(e,directions.RIGHT)],this.scene=e.group(this.exitPit,this.spikes[0].sprite,this.spikes[1].sprite,this.spikes[2].sprite,this.spikes[3].sprite),this.scene.visible=!1,this.fromDir="",this.enemies=[],this.treasure=null,this.hasTreasure=!1,this.canOpen=!1,this.deathCount=0,this.bossRoom=!1,this.deathMax=30,this.actionKey=e.keyboard(70),this.actionKey.press=()=>{this.canOpen?this.treasure.activate():!this.player.sword.active&&this.scene.visible&&this.player.sword.startSwing(this.player.sprite.direction,this.player.sprite.x+this.player.sprite.halfWidth,this.player.sprite.y-this.player.sprite.halfHeight)}};EnemyRoom.prototype.load=function(e,t,i,s,n){this.g.stage.putCenter(this.player.sprite,0,0),this.exitPit.visible=!1,this.g.stage.putCenter(this.exitPit,0,-50),this.fromDir=e,this.hasTreasure=s,t||(s?(this.loadEnemies(Math.floor(1.5*i),2),this.treasure=n,this.scene.addChild(n.sprite)):this.loadEnemies(i,1),this.enemies.length>0&&this.placeEnemies())},EnemyRoom.prototype.loadBoss=function(){this.g.stage.putCenter(this.player.sprite,0,0),this.enemies.push(new Boss(this.g,this.player.sprite)),this.bossRoom=!0,this.exitPit.visible=!1,this.g.stage.putCenter(this.exitPit,0,-50)},EnemyRoom.prototype.loadEnemies=function(e,t){for(let i=0;i<e;i++)this.enemies.push(new Enemy(this.g,t))},EnemyRoom.prototype.placeEnemies=function(){let e=360/this.enemies.length,t=0,i=this.g.canvas.width/2,s=this.g.canvas.height/2,n=this.g.canvas.width/4;this.enemies.forEach((r,a)=>{let o=this.g.rotateAroundPoint(i,s,n,n,toRadians(t));t+=e,r.sprite.x=o.x,r.sprite.y=o.y})},EnemyRoom.prototype.loop=function(){if(this.player.dead)return this.deathCount++,this.scene.alpha-=.02,void(this.deathCount>=this.deathMax&&(this.g.state=new GameOver(this.g,["You have died"])));if(this.player.sword.active||this.g.move(this.player.sprite),0==this.player.sprite.vx&&0==this.player.sprite.vy||(this.canOpen=!1),this.g.contain(this.player.sprite,this.g.stage.localBounds),this.exitPit.visible&&this.g.hitTestRectangle(this.player.sprite,this.exitPit)&&this.loadNext(directions.BACK,this.fromDir),this.hasTreasure&&this.treasure.sprite.visible&&this.g.rectangleCollision(this.player.sprite,this.treasure.sprite)&&(this.canOpen=!0),this.spikes.forEach(e=>{this.g.hitTestRectangle(this.player.sprite,e.sprite)&&this.player.takeDamage(1,e.side)}),this.player.sword.active&&(this.g.rotateAroundSprite(this.player.sword.sprite,this.player.sprite,this.player.sprite.width,this.player.sword.degrees),this.player.sword.swing()),0!==this.enemies.length||this.exitPit.visible)for(let e=this.enemies.length-1;e>=0;e--){let t=this.enemies[e];if(this.player.sword.active&&!t.invincible){this.g.hitTestRectangle(this.player.sword.sprite,t.sprite)&&t.takeDamage(this.player.sword.damage,reverseDirection(this.player.sprite.direction),this.player.sprite)}if(t.dead)this.g.remove(t.sprite),this.g.remove(t.healthSprite),this.enemies.splice(e,1);else if(t.sprite.visible&&(this.g.followConstant(t.sprite,this.player.sprite,t.speed),this.g.contain(t.sprite,this.g.stage.localBounds),t.moveHealth(),!this.player.invincible)){let e=this.g.rectangleCollision(this.player.sprite,t.sprite,!0);e&&this.player.takeDamage(t.damage,e)}}else this.g.hitTestRectangle(this.exitPit,this.player.sprite)&&(this.exitPit.y=50),this.exitPit.visible=!0,this.hasTreasure&&(this.treasure.sprite.visible=!0,this.g.stage.putCenter(this.treasure.sprite,0,this.g.canvas.height/4))};let Treasure=function(e,t,i,s){Interactable.call(this,e,()=>{this.open(),s()},{}),this.name=t,this.description=i,this.sprite=e.rectangle(32,32,"gold"),this.sprite.visible=!1,this.scene={},this.textUtils=new TextUtil(e)};Treasure.prototype=Object.create(Interactable.prototype),Treasure.prototype.open=function(){const e=this.g;let t=e.canvas.height/4;this.sprite.fillStyle="brown";let i=e.rectangle(e.canvas.width,e.canvas.height/2,"teal","teal",1,0,t-50),s=this.textUtils.centeredTexts(["You found a",`${this.name}`],48,"black",t,50),n=this.textUtils.centeredTexts([`${this.description}`],32,"black",t+100,35);this.scene=e.group(i,s[0],s[1],n[0]),this.g.wait(1500,()=>this.hideModal())},Treasure.prototype.hideModal=function(){this.scene.visible=!1};let templates=["Your path is $good.","$good is good.","Danger $bad, $bad, and $bad.","$good","Go $good","Hark! $good lies in safety.","Fight or be conquered at $bad, $bad, and $bad"],treasureTemplates=["$treasure holds fortune, but $good is the way forward.","$good to proceed. If treasure you seek then go $treasure.","Noises come from $treasure, $bad and $bad hold a sense of dread.","$treasure shines, $bad and $bad are dark."],dirs={up:["north","up","ahead"],down:["south","down","behind"],left:["west","left"],right:["east","right"]};function parseSentence(e,t,i=!1,s){let n=directions.ALL;i&&(e=e.replace(/\$treasure/g,dirs[s][getRand(dirs[s].length)]),n=n.filter(e=>e!=s)),n=n.filter(e=>e!=t);let r=dirs[t][getRand(dirs[t].length)];return e=e.replace("$good",r),n.forEach(t=>e=e.replace("$bad",dirs[t][getRand(dirs[t].length)])),e}function normalSentence(e){let t=templates[getRand(templates.length)];return t=parseSentence(t,e)}function treasureSentence(e,t=UP){let i=treasureTemplates[getRand(treasureTemplates.length)];return i=parseSentence(i,e,!0,t)}let getSentence=function(e,t,i){return t?treasureSentence(e,i):normalSentence(e)},Maze=function(e,t){switch(this.g=e,this.player=e.globals.player,this.level=0,this.endLevel=10,this.goodDir="",this.treasureDir="",this.mode=t,this.statueRoom=new StatueRoom(this.g,t,function(e){this.loadNext(e)}.bind(this)),this.enemyRoom={},this.treasureRoom={},this.explored=[],this.showingChar=!1,this.shownSprite=null,this.treasures=[new Treasure(this.g,"Health Potion","HP increased by 5",()=>this.g.globals.player.heal(5)),new Treasure(this.g,"Sharp Sword","Damage increased by 1",()=>this.g.globals.player.sword.damage+=1)],t){case modes[0]:case modes[1]:this.treasures.push(new Treasure(this.g,"Dictionary","A character is revealed",function(){this.showingChar=!0}.bind(this)));break;case modes[2]:this.treasures.push(new Treasure(this.g,"Monochrome","Morse speed down",function(){this.g.globals.GAME_TEMPO-=60}.bind(this)))}return this.dirs=directions.ALL,this.currentRoom=this.statueRoom,this.numWrongRooms=0,this.levelText=e.text(`${this.level}`,"28px sans-serif","black"),this.levelText.layer=1e3,this.loadNext(this.goodDir),e.globals.player.show(),()=>this.loop()};Maze.prototype.loadNext=function(e,t){if(this.level===this.endLevel)return void this.endGame();this.currentRoom.scene.visible=!1,this.player.invincible=!0,this.player.loseInvincibility();let i=this.numWrongRooms/2;if(e===directions.BACK)this.statueRoom.placePlayer(t),this.currentRoom=this.statueRoom;else if(e===this.goodDir)this.enterNextLevel();else if(e===this.treasureDir){if(this.explored.includes(e))this.treasureRoom.load(e,!0,i,!0,{});else{let t=getRand(this.treasures.length);this.treasureRoom.load(e,!1,i,!0,this.treasures.splice(t,1)[0])}this.currentRoom=this.treasureRoom,this.explored.push(e)}else this.enemyRoom.load(e,this.explored.includes(e),i,!1),this.currentRoom=this.enemyRoom,this.explored.includes(e)||(this.explored.push(e),this.numWrongRooms++);this.currentRoom.scene.visible=!0,this.player.stopMoving()},Maze.prototype.enterNextLevel=function(){this.level++,this.enemyRoom=new EnemyRoom(this.g,function(e,t){this.loadNext(e,t)}.bind(this)),this.treasureRoom=new EnemyRoom(this.g,function(e,t){this.loadNext(e,t)}.bind(this)),this.levelText.content=`lv ${this.level}`;let e=getRand(this.dirs.length);if(this.goodDir=this.dirs[e],this.level===this.endLevel){if(0!==this.treasures.length)return void this.endGame();this.enemyRoom.loadBoss(),this.currentRoom=this.enemyRoom}else{let t,i=getRand(this.endLevel-this.level)<this.treasures.length;if(i){do{t=getRand(this.dirs.length)}while(t===e);this.treasureDir=this.dirs[t]}else this.treasureDir="";this.statueRoom.load(getSentence(this.goodDir,i,this.treasureDir),this.showingChar),this.explored=[],this.currentRoom=this.statueRoom}},Maze.prototype.endGame=function(){this.currentRoom.scene.alpha=0,this.player.hide(),this.player.sword.sprite.visible=!1,this.g.state=new GameOver(this.g,0===this.treasures.length?["You found the kids","safe and sound","and managed to","make it back alive.","Congratulations hero."]:["You made it back,","but the kids were","never seen again."])},Maze.prototype.loop=function(){this.currentRoom.loop(),this.g.stage.putTop(this.levelText,this.g.canvas.width/2-50,20),this.g.stage.putTop(this.player.healthSprite,-this.g.canvas.width/2+this.player.healthSprite.halfWidth+10,40)};let Menu=function(e){this.g=e;let t=e.stage.height/4,i=e.stage.width/2.5;return this.selected=0,this.actions=modes.map((s,n)=>new Button(e,s,i,t+50*n,15*s.length,20)),this.actions[0].select(),this.actionKey=e.keyboard(70),this.cancelKey=e.keyboard(68),e.key.upArrow.press=()=>{this.select(-1)},e.key.downArrow.press=()=>{this.select(1)},this.actionKey.press=()=>{this.actions.forEach(e=>{this.g.remove(e.scene)}),this.actionKey.press=null,this.cancelKey.press=null,e.state=new Maze(this.g,modes[this.selected])},()=>{}};Menu.prototype.select=function(e){this.actions[this.selected].deselect(),this.selected=(this.selected+=e)%this.actions.length,this.selected<0&&(this.selected=this.actions.length-1),this.actions[this.selected].select()};let Button=function(e,t,i,s,n,r){this.text=e.text(t,"20px Monospace","black",i,s),this.rect=e.rectangle(n,r,"gray","black",1,i-10,s),this.scene=e.group(this.rect,this.text)};Button.prototype.select=function(){this.rect.fillStyle="teal"},Button.prototype.deselect=function(){this.rect.fillStyle="gray"};let Sword=function(e){this.degrees=0,this.active=!1,this.sprite=e.rectangle(40,5,"gray"),this.sprite.visible=!1,this.sprite.rotation=0,this.deltaAngle=Math.PI/16,this.frame=0,this.damage=1,this.maxFrame=12};Sword.prototype.startSwing=function(e,t,i){switch(e){case"left":this.degrees=Math.PI/2;break;case"right":this.degrees=3*Math.PI/2;break;case"up":this.degrees=Math.PI;break;case"down":this.degrees=0}this.sprite.x=t,this.sprite.y=i,this.sprite.rotation=this.degrees,this.sprite.visible=!0,this.active=!0},Sword.prototype.swing=function(){this.degrees+=this.deltaAngle,this.sprite.rotation=this.degrees,this.frame++,this.frame>this.maxFrame&&(this.active=!1,this.degrees=0,this.frame=0,this.sprite.visible=!1)};let Player=function(e){this.sprite=e.rectangle(32,32,"blue"),this.sprite.visible=!1,this.actionKey=e.keyboard(70),this.cancelKey=e.keyboard(68),e.fourKeyController(this.sprite,5,38,39,40,37),this.sword=new Sword(e),Actor.call(this,e,5,1e3,30)};Player.prototype=Object.create(Actor.prototype);var GA=GA||{};GA.VERSION="0.0.1",GA.plugins=void 0,GA.custom=void 0,GA.create=function(e,t,i,s,n){var r,a={};if(a.canvas=document.createElement("canvas"),a.canvas.setAttribute("width",1*e),a.canvas.setAttribute("height",1*t),a.canvas.style.backgroundColor="black",document.body.appendChild(a.canvas),a.canvas.ctx=a.canvas.getContext("2d"),a.stage=(c(r={}),r.stage=!0,r.width=a.canvas.width,r.height=a.canvas.height,r.x=0,r.y=0,r.parent=void 0,r),a.key=function(){var e={};return e.leftArrow=p(37),e.upArrow=p(38),e.rightArrow=p(39),e.downArrow=p(40),e.space=p(32),e}(),a.buttons=[],a.dragAndDrop=!1,a.draggableSprites=[],a.tweens=[],a.state=void 0,a.load=n||void 0,a.setup=i||void 0,void 0===a.setup)throw new Error("Please supply the setup function in the constructor");function o(){if(requestAnimationFrame(o,a.canvas),void 0===a._fps)l(),a.render(a.canvas,0);else{var e=Date.now(),t=e-a._startTime;for(t>1e3&&(t=a._frameDuration),a._startTime=e,a._lag+=t;a._lag>=a._frameDuration;)h(),l(),a._lag-=a._frameDuration;var i=a._lag/a._frameDuration;a.render(a.canvas,i)}}function h(){a.stage.children.forEach((function(e){!function e(t){t._previousX=t.x;t._previousY=t.y;t.children&&t.children.length>0&&t.children.forEach((function(t){e(t)}))}(e)}))}function l(){if(a.buttons.length>0){a.canvas.style.cursor="auto";for(var e=a.buttons.length-1;e>=0;e--){var t=a.buttons[e];t.update(a.pointer,a.canvas),"over"!==t.state&&"down"!==t.state||t.stage||(a.canvas.style.cursor="pointer")}}if(a.dragAndDrop&&a.pointer.updateDragAndDrop(),a.state&&!a.paused&&a.state(),0!==a.updateFunctions.length)for(var i=0;i<a.updateFunctions.length;i++){(0,a.updateFunctions[i])()}}function c(e){e.x=0,e.y=0,e.vx=0,e.vy=0,e.width=0,e.height=0,e.scaleX=1,e.scaleY=1,e.pivotX=.5,e.pivotY=.5,e.rotation=0,e.visible=!0,e.parent=void 0,e.stage=!1,e._alpha=1,e._layer=0,e._circular=!1,e._previousX=void 0,e._previousY=void 0,e.children=[],e.addChild=function(t){t.parent&&t.parent.removeChild(t),t.parent=e,e.children.push(t)},e.removeChild=function(t){if(t.parent!==e)throw new Error(t+"is not a child of "+e);e.children.splice(e.children.indexOf(t),1)},e.swapChildren=function(t,i){var s=e.children.indexOf(t),n=e.children.indexOf(i);if(-1===s||-1===n)throw new Error(child+" Both objects must be a child of the caller "+e);t.childIndex=n,i.childIndex=s,e.children[s]=i,e.children[n]=t},e.add=function(t){var i=Array.prototype.slice.call(arguments);i.length>1?i.forEach((function(t){e.addChild(t)})):e.addChild(i[0])},e.remove=function(t){var i=Array.prototype.slice.call(arguments);i.length>1?i.forEach((function(t){e.removeChild(t)})):e.removeChild(i[0])},e.setPosition=function(t,i){e.x=t,e.y=i};var t=e;e.putCenter=function(i,s,n){s=s||0,n=n||0,i.x=t.x+t.halfWidth-i.halfWidth+s,i.y=t.y+t.halfHeight-i.halfHeight+n,e.compensateForParentPosition(t,i)},e.putTop=function(i,s,n){s=s||0,n=n||0,i.x=t.x+t.halfWidth-i.halfWidth+s,i.y=t.y-i.height+n,e.compensateForParentPosition(t,i)},e.putRight=function(i,s,n){s=s||0,n=n||0,i.x=t.x+t.width+s,i.y=t.y+t.halfHeight-i.halfHeight+n,e.compensateForParentPosition(t,i)},e.putBottom=function(i,s,n){s=s||0,n=n||0,i.x=t.x+t.halfWidth-i.halfWidth+s,i.y=t.y+t.height+n,e.compensateForParentPosition(t,i)},e.putLeft=function(i,s,n){s=s||0,n=n||0,i.x=t.x-i.width+s,i.y=t.y+t.halfHeight-i.halfHeight+n,e.compensateForParentPosition(t,i)},e.compensateForParentPosition=function(e,t){0===t.parent.gx&&0===t.parent.gy||(t.x-=e.gx,t.y-=e.gy)},Object.defineProperties(e,{gx:{get:function(){return this.parent?this.x+this.parent.gx:this.x},enumerable:!0,configurable:!0},gy:{get:function(){return this.parent?this.y+this.parent.gy:this.y},enumerable:!0,configurable:!0},position:{get:function(){return{x:e.x,y:e.y}},enumerable:!0,configurable:!0},alpha:{get:function(){return e.parent._alpha*e._alpha},set:function(t){e._alpha=t},enumerable:!0,configurable:!0},halfWidth:{get:function(){return e.width/2},enumerable:!0,configurable:!0},halfHeight:{get:function(){return e.height/2},enumerable:!0,configurable:!0},centerX:{get:function(){return e.x+e.halfWidth},enumerable:!0,configurable:!0},centerY:{get:function(){return e.y+e.halfHeight},enumerable:!0,configurable:!0},layer:{get:function(){return e._layer},set:function(t){e._layer=t,e.parent.children.sort(u)},enumerable:!0,configurable:!0},circular:{get:function(){return e._circular},set:function(t){!0===t&&!1===e._circular&&(d(e),e._circular=!0),!1===t&&!0===e._circular&&(delete e.diameter,delete e.radius,e._circular=!1)},enumerable:!0,configurable:!0},localBounds:{get:function(){return{x:0,y:0,width:e.width,height:e.height}},enumerable:!0,configurable:!0},globalBounds:{get:function(){return rectangle={x:e.gx,y:e.gy,width:e.gx+e.width,height:e.gy+e.height},rectangle},enumerable:!0,configurable:!0},empty:{get:function(){return 0===e.children.length},enumerable:!0,configurable:!0}})}function d(e){Object.defineProperties(e,{diameter:{get:function(){return e.width},set:function(t){e.width=t,e.height=t},enumerable:!0,configurable:!0},radius:{get:function(){return e.width/2},set:function(t){e.width=2*t,e.height=2*t},enumerable:!0,configurable:!0}})}function p(e){var t={};return t.code=e,t.isDown=!1,t.isUp=!0,t.press=void 0,t.release=void 0,t.downHandler=function(e){e.keyCode===t.code&&(t.isUp&&t.press&&t.press(),t.isDown=!0,t.isUp=!1),e.preventDefault()},t.upHandler=function(e){e.keyCode===t.code&&(t.isDown&&t.release&&t.release(),t.isDown=!1,t.isUp=!0),e.preventDefault()},window.addEventListener("keydown",t.downHandler.bind(t),!1),window.addEventListener("keyup",t.upHandler.bind(t),!1),t}function u(e,t){return e.layer<t.layer?-1:(e.layer,t.layer,1)}return a.assetFilePaths=s||void 0,a.paused=!1,a._fps=60,a._startTime=Date.now(),a._frameDuration=1e3/a._fps,a._lag=0,a.interpolate=!0,a.updateFunctions=[],a.scale=1,a.start=function(){a.assetFilePaths?(a.assets.whenLoaded=function(){a.state=void 0,a.setup()},a.assets.load(a.assetFilePaths),a.load&&(a.state=a.load)):a.setup(),o()},Object.defineProperties(a,{fps:{get:function(){return a._fps},set:function(e){a._fps=e,a._startTime=Date.now(),a._frameDuration=1e3/a._fps},enumerable:!0,configurable:!0},backgroundColor:{set:function(e){a.canvas.style.backgroundColor=e},enumerable:!0,configurable:!0}}),a.remove=function(e){var t=Array.prototype.slice.call(arguments);if(t[0]instanceof Array){var i=t[0];if(i.length>0)for(var s=i.length-1;s>=0;s--){var n=i[s];n.parent.removeChild(n),i.splice(i.indexOf(n),1)}}else t.length>1?t.forEach((function(e){e.parent.removeChild(e)})):t[0].parent.removeChild(t[0])},a.group=function(e){var t={};if(c(t),t.addChild=function(e){e.parent&&e.parent.removeChild(e),e.parent=t,t.children.push(e),t.calculateSize()},t.removeChild=function(e){if(e.parent!==t)throw new Error(e+"is not a child of "+t);t.children.splice(t.children.indexOf(e),1),t.calculateSize()},t.calculateSize=function(){t.children.length>0&&(t._newWidth=0,t._newHeight=0,t.children.forEach((function(e){e.x+e.width>t._newWidth&&(t._newWidth=e.x+e.width),e.y+e.height>t._newHeight&&(t._newHeight=e.y+e.height)})),t.width=t._newWidth,t.height=t._newHeight)},a.stage.addChild(t),e){var i=Array.prototype.slice.call(arguments);i.forEach((function(e){t.addChild(e)}))}return t},a.rectangle=function(e,t,i,s,n,r,o){var h={};return c(h),h.mask=!1,h.width=e||32,h.height=t||32,h.fillStyle=i||"red",h.strokeStyle=s||"none",h.lineWidth=n||0,h.x=r||0,h.y=o||0,a.stage.addChild(h),h.render=function(e){e.strokeStyle=h.strokeStyle,e.lineWidth=h.lineWidth,e.fillStyle=h.fillStyle,e.beginPath(),e.rect(-h.width*h.pivotX,-h.height*h.pivotY,h.width,h.height),!0===h.mask?e.clip():("none"!==h.strokeStyle&&e.stroke(),"none"!==h.fillStyle&&e.fill())},h},a.circle=function(e,t,i,s,n,r){var o={};return c(o),o.mask=!1,o.width=e||32,o.height=e||32,o.fillStyle=t||"red",o.strokeStyle=i||"none",o.lineWidth=s||"none",o.x=n||0,o.y=r||0,a.stage.addChild(o),d(o),o.render=function(e){e.strokeStyle=o.strokeStyle,e.lineWidth=o.lineWidth,e.fillStyle=o.fillStyle,e.beginPath(),e.arc(o.radius+-o.diameter*o.pivotX,o.radius+-o.diameter*o.pivotY,o.radius,0,2*Math.PI,!1),!0===o.mask?e.clip():("none"!==o.strokeStyle&&e.stroke(),"none"!==o.fillStyle&&e.fill())},o},a.text=function(e,t,i,s,n){var r={};return c(r),r.content=e||"Hello!",r.font=t||"12px sans-serif",r.fillStyle=i||"red",r.textBaseline="top",Object.defineProperties(r,{width:{get:function(){return a.canvas.ctx.measureText(r.content).width},enumerable:!0,configurable:!0},height:{get:function(){return a.canvas.ctx.measureText("M").width},enumerable:!0,configurable:!0}}),a.stage.addChild(r),r.x=s||0,r.y=n||0,r.render=function(e){e.strokeStyle=r.strokeStyle,e.lineWidth=r.lineWidth,e.fillStyle=r.fillStyle,0===r.width&&(r.width=e.measureText(r.content).width),0===r.height&&(r.height=e.measureText("M").width),e.translate(-r.width*r.pivotX,-r.height*r.pivotY),e.font=r.font,e.textBaseline=r.textBaseline,e.fillText(r.content,0,0)},r},a.render=function(e,t){var i=e.ctx;i.clearRect(0,0,e.width,e.height);for(var s=0;s<a.stage.children.length;s++){n(a.stage.children[s])}function n(s){if(s.visible&&s.gx<e.width+s.width&&s.gx+s.width>=-s.width&&s.gy<e.height+s.height&&s.gy+s.height>=-s.height){if(i.save(),a.interpolate?(void 0!==s._previousX?s.renderX=(s.x-s._previousX)*t+s._previousX:s.renderX=s.x,void 0!==s._previousY?s.renderY=(s.y-s._previousY)*t+s._previousY:s.renderY=s.y):(s.renderX=s.x,s.renderY=s.y),i.translate(s.renderX+s.width*s.pivotX,s.renderY+s.height*s.pivotY),i.globalAlpha=s.alpha,i.rotate(s.rotation),i.scale(s.scaleX,s.scaleY),s.render&&s.render(i),s.children&&s.children.length>0){i.translate(-s.width*s.pivotX,-s.height*s.pivotY);for(var r=0;r<s.children.length;r++){n(s.children[r])}}i.restore()}}},a.keyboard=p,a.makeDisplayObject=c,void 0!==GA.plugins&&GA.plugins(a),void 0!==GA.custom&&GA.custom(a),a},window.ga=GA.create,window.GA=GA;var ga=window.ga;function internal_move(e){e.x+=0|e.vx,e.y+=0|e.vy}window.GA.custom=function(e){e.move=function(e){if(e instanceof Array==!1)internal_move(e);else for(var t=0;t<e.length;t++)internal_move(e[t])},e.fourKeyController=function(t,i,s,n,r,a){t.direction="";let o=e.keyboard(a),h=e.keyboard(s),l=e.keyboard(n),c=e.keyboard(r);o.press=function(){t.vx=-i,t.vy=0,t.direction="left"},o.release=function(){l.isDown||0!==t.vy||(t.vx=0)},h.press=function(){t.vy=-i,t.vx=0,t.direction="up"},h.release=function(){c.isDown||0!==t.vx||(t.vy=0)},l.press=function(){t.vx=i,t.vy=0,t.direction="right"},l.release=function(){o.isDown||0!==t.vy||(t.vx=0)},c.press=function(){t.vy=i,t.vx=0,t.direction="down"},c.release=function(){h.isDown||0!==t.vx||(t.vy=0)}},e.contain=function(e,t,i,s){var n,r=t.x,a=t.y,o=t.width,h=t.height;return i=i||!1,e.x<r&&(i&&(e.vx*=-1),e.mass&&(e.vx/=e.mass),e.x=r,n="left"),e.y<a&&(i&&(e.vy*=-1),e.mass&&(e.vy/=e.mass),e.y=a,n="top"),e.x+e.width>o&&(i&&(e.vx*=-1),e.mass&&(e.vx/=e.mass),e.x=o-e.width,n="right"),e.y+e.height>h&&(i&&(e.vy*=-1),e.mass&&(e.vy/=e.mass),e.y=h-e.height,n="bottom"),n&&s&&s(n),n},e.rotateAroundSprite=function(e,t,i,s){e.x=t.centerX-e.parent.x+i*Math.cos(s)-e.halfWidth,e.y=t.centerY-e.parent.y+i*Math.sin(s)},e.rotateAroundPoint=function(e,t,i,s,n){var r={};return r.x=e+Math.cos(n)*i,r.y=t+Math.sin(n)*s,r},e.followConstant=function(e,t,i){var s=t.centerX-e.centerX,n=t.centerY-e.centerY,r=Math.sqrt(s*s+n*n);r>=i&&(e.x+=s/r*i,e.y+=n/r*i)},e.hitTestRectangle=function(e,t,i){var s,n,r,a;return void 0===i&&(i=!1),!1,i?(r=e.gx+e.halfWidth-(t.gx+t.halfWidth),a=e.gy+e.halfHeight-(t.gy+t.halfHeight)):(r=e.centerX-t.centerX,a=e.centerY-t.centerY),s=e.halfWidth+t.halfWidth,n=e.halfHeight+t.halfHeight,Math.abs(r)<s&&Math.abs(a)<n},e.rectangleCollision=function(e,t,i,s){var n,r,a,o,h,l,c;return void 0===i&&(i=!1),void 0===s&&(s=!1),s?(l=e.gx+e.halfWidth-(t.gx+t.halfWidth),c=e.gy+e.halfHeight-(t.gy+t.halfHeight)):(l=e.centerX-t.centerX,c=e.centerY-t.centerY),r=e.halfWidth+t.halfWidth,a=e.halfHeight+t.halfHeight,Math.abs(l)<r&&Math.abs(c)<a&&((o=r-Math.abs(l))>=(h=a-Math.abs(c))?(c>0?(n="top",e.y=e.y+h):(n="bottom",e.y=e.y-h),i&&(e.vy*=-1)):(l>0?(n="left",e.x=e.x+o):(n="right",e.x=e.x-o),i&&(e.vx*=-1))),n},e.wait=function(e,t){return setTimeout(t,e)}};var g=ga(512,512,setup);function setup(){g.canvas.style.border="1px black dashed",g.backgroundColor="white",g.canvas.style.display="block",g.canvas.style.margin="auto";let e=new Player(g);e.sprite.layer=5,g.globals={player:e,GAME_TEMPO:440},g.state=new Menu(g)}g.start();
