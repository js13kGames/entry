<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="style.css">
    <!-- <script type="module" src="modules/audio.js"></script>
    <script type="module" src="modules/generator.js"></script>
    <script type="module" src="modules/renderer.js"></script>
    <script type="module" src="modules/game.js"></script> -->
    <script>
    function x(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function y(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:x(a)}}var z="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},A="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;
function B(){B=function(){};A.Symbol||(A.Symbol=aa)}function ba(a,b){this.da=a;z(this,"description",{configurable:!0,writable:!0,value:b})}ba.prototype.toString=function(){return this.da};var aa=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new ba("jscomp_symbol_"+(c||"")+"_"+b++,c)}var b=0;return a}();
function C(){B();var a=A.Symbol.iterator;a||(a=A.Symbol.iterator=A.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&z(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return ca(x(this))}});C=function(){}}function ca(a){C();a={next:a};a[A.Symbol.iterator]=function(){return this};return a}var E;
if("function"==typeof Object.setPrototypeOf)E=Object.setPrototypeOf;else{var F;a:{var da={ea:!0},ea={};try{ea.__proto__=da;F=ea.ea;break a}catch(a){}F=!1}E=F?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var fa=E;function G(){this.C=!1;this.j=null;this.M=void 0;this.b=1;this.X=this.ka=0;this.A=null}function H(a){if(a.C)throw new TypeError("Generator is already running");a.C=!0}G.prototype.D=function(a){this.M=a};
G.prototype.H=function(a){this.A={ma:a,ra:!0};this.b=this.ka||this.X};G.prototype["return"]=function(a){this.A={"return":a};this.b=this.X};function I(a,b,c){a.b=c;return{value:b}}function J(a){this.a=new G;this.wa=a}J.prototype.D=function(a){H(this.a);if(this.a.j)return K(this,this.a.j.next,a,this.a.D);this.a.D(a);return M(this)};function ha(a,b){H(a.a);var c=a.a.j;if(c)return K(a,"return"in c?c["return"]:function(e){return{value:e,done:!0}},b,a.a["return"]);a.a["return"](b);return M(a)}
J.prototype.H=function(a){H(this.a);if(this.a.j)return K(this,this.a.j["throw"],a,this.a.D);this.a.H(a);return M(this)};function K(a,b,c,e){try{var d=b.call(a.a.j,c);if(!(d instanceof Object))throw new TypeError("Iterator result "+d+" is not an object");if(!d.done)return a.a.C=!1,d;var g=d.value}catch(f){return a.a.j=null,a.a.H(f),M(a)}a.a.j=null;e.call(a.a,g);return M(a)}
function M(a){for(;a.a.b;)try{var b=a.wa(a.a);if(b)return a.a.C=!1,{value:b.value,done:!1}}catch(c){a.a.M=void 0,a.a.H(c)}a.a.C=!1;if(a.a.A){b=a.a.A;a.a.A=null;if(b.ra)throw b.ma;return{value:b["return"],done:!0}}return{value:void 0,done:!0}}function ia(a){this.next=function(b){return a.D(b)};this["throw"]=function(b){return a.H(b)};this["return"]=function(b){return ha(a,b)};C();this[Symbol.iterator]=function(){return this}}
function ja(a){var b=ka;a=new ia(new J(a));fa&&fa(a,b.prototype);return a}function la(a,b){if(b){for(var c=A,e=a.split("."),d=0;d<e.length-1;d++){var g=e[d];g in c||(c[g]={});c=c[g]}e=e[e.length-1];d=c[e];g=b(d);g!=d&&null!=g&&z(c,e,{configurable:!0,writable:!0,value:g})}}
la("Promise",function(a){function b(f){this.G=0;this.R=void 0;this.s=[];var k=this.O();try{f(k.resolve,k.reject)}catch(h){k.reject(h)}}function c(){this.h=null}function e(f){return f instanceof b?f:new b(function(k){k(f)})}if(a)return a;c.prototype.S=function(f){if(null==this.h){this.h=[];var k=this;this.T(function(){k.na()})}this.h.push(f)};var d=A.setTimeout;c.prototype.T=function(f){d(f,0)};c.prototype.na=function(){for(;this.h&&this.h.length;){var f=this.h;this.h=[];for(var k=0;k<f.length;++k){var h=
f[k];f[k]=null;try{h()}catch(l){this.fa(l)}}}this.h=null};c.prototype.fa=function(f){this.T(function(){throw f;})};b.prototype.O=function(){function f(l){return function(m){h||(h=!0,l.call(k,m))}}var k=this,h=!1;return{resolve:f(this.ya),reject:f(this.P)}};b.prototype.ya=function(f){if(f===this)this.P(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof b)this.za(f);else{a:switch(typeof f){case "object":var k=null!=f;break a;case "function":k=!0;break a;default:k=!1}k?this.xa(f):
this.Y(f)}};b.prototype.xa=function(f){var k=void 0;try{k=f.then}catch(h){this.P(h);return}"function"==typeof k?this.Aa(k,f):this.Y(f)};b.prototype.P=function(f){this.ca(2,f)};b.prototype.Y=function(f){this.ca(1,f)};b.prototype.ca=function(f,k){if(0!=this.G)throw Error("Cannot settle("+f+", "+k+"): Promise already settled in state"+this.G);this.G=f;this.R=k;this.oa()};b.prototype.oa=function(){if(null!=this.s){for(var f=0;f<this.s.length;++f)g.S(this.s[f]);this.s=null}};var g=new c;b.prototype.za=
function(f){var k=this.O();f.J(k.resolve,k.reject)};b.prototype.Aa=function(f,k){var h=this.O();try{f.call(k,h.resolve,h.reject)}catch(l){h.reject(l)}};b.prototype.then=function(f,k){function h(t,r){return"function"==typeof t?function(p){try{l(t(p))}catch(n){m(n)}}:r}var l,m,w=new b(function(t,r){l=t;m=r});this.J(h(f,l),h(k,m));return w};b.prototype["catch"]=function(f){return this.then(void 0,f)};b.prototype.J=function(f,k){function h(){switch(l.G){case 1:f(l.R);break;case 2:k(l.R);break;default:throw Error("Unexpected state: "+
l.G);}}var l=this;null==this.s?g.S(h):this.s.push(h)};b.resolve=e;b.reject=function(f){return new b(function(k,h){h(f)})};b.race=function(f){return new b(function(k,h){for(var l=y(f),m=l.next();!m.done;m=l.next())e(m.value).J(k,h)})};b.all=function(f){var k=y(f),h=k.next();return h.done?e([]):new b(function(l,m){function w(p){return function(n){t[p]=n;r--;0==r&&l(t)}}var t=[],r=0;do t.push(void 0),r++,e(h.value).J(w(t.length-1),m),h=k.next();while(!h.done)})};return b});
la("Promise.prototype.finally",function(a){return a?a:function(b){return this.then(function(c){return Promise.resolve(b()).then(function(){return c})},function(c){return Promise.resolve(b()).then(function(){throw c;})})}});function ma(a){function b(e){return a.next(e)}function c(e){return a["throw"](e)}return new Promise(function(e,d){function g(f){f.done?e(f.value):Promise.resolve(f.value).then(b,c).then(g,d)}g(a.next())})}function N(a){return ma(new ia(new J(a)))}var O={};P("left",[65,37]);
P("right",[68,39]);P("up",[87,38]);P("down",[83,40]);function P(a,b){O[a]=!1;document.addEventListener("keydown",function(c){b.includes(c.keyCode)&&(c.preventDefault(),O[a]=!0)});document.addEventListener("keyup",function(c){b.includes(c.keyCode)&&(c.preventDefault(),O[a]=!1)})}
function na(a,b){this.width=a;this.height=b;this.va=JSON.parse('{"0":{"0":{"0":{"0":{"0":{"0":{"0":{"0":{"0":{"score":1}}},"1":{"1":{"1":{"score":1}}}}},"1":{"0":{"0":{"0":{"0":{"score":-1}}}}}},"1":{"1":{"1":{"1":{"1":{"1":{"score":-1}}}}}}},"1":{"0":{"0":{"1":{"0":{"0":{"1":{"score":1}}},"1":{"1":{"1":{"score":1}}}}}}}},"1":{"1":{"0":{"1":{"1":{"0":{"1":{"1":{"score":-1}}}}}}}}},"1":{"0":{"0":{"1":{"0":{"0":{"1":{"0":{"0":{"score":1}},"1":{"1":{"score":1}}}}}}}},"1":{"0":{"1":{"1":{"0":{"1":{"1":{"0":{"score":-1}}}}}}},"1":{"0":{"0":{"0":{"0":{"0":{"0":{"score":1}}}},"1":{"0":{"0":{"1":{"score":1}}}}}},"1":{"0":{"0":{"1":{"0":{"0":{"score":1}}}},"1":{"1":{"1":{"1":{"score":-1}}}}},"1":{"1":{"0":{"0":{"0":{"score":-1}}},"1":{"1":{"1":{"score":-1}}}}}}}}}}');this.ba=
0;this.data=Array(this.width*this.height);this.B=Array(this.data.length);for(var c=0;c<this.height;c++)for(var e=0;e<this.width;e++)this.data[c*this.width+e]=Math.random()<.5+this.ba?1:0}
function oa(a){for(var b=0;b<a.B.length;b++)a.B[b]=0;for(b=0;b<a.width-2;b++)for(var c=0;c<a.height-2;c++){for(var e=[],d=0;3>d;d++)for(var g=0;3>g;g++)e.push(a.data[a.width*(c+d)+b+g]);a:{d=a.va;for(g=0;g<e.length;g++){if(!d[e[g]]){e=0;break a}d=d[e[g]]}e=d.Ba}if(0!=e)for(d=0;3>d;d++)for(g=0;3>g;g++)a.B[a.width*(c+d)+b+g]+=e}for(b=0;b<a.height;b++)for(c=0;c<a.width;c++)e=b*a.width+c,a.data[e]=0>=a.B[e]?Math.random()<.5+a.ba?1:0:a.data[e]}
function pa(){this.size=64;for(var a=[1,1,1,1].map(function(d){return new na(64*d,64*d)}),b=y(a),c=b.next();!c.done;c=b.next()){c=c.value;for(var e=0;100>e;e++)oa(c)}this.pa=a[0].data;this.Z=[];b={};c=y(ka(64,64));for(e=c.next();!e.done;b={w:b.w},e=c.next())b.w=e.value,e=a.map(function(d){return function(g){return 1-g.data[d.w.index]}}(b)).reduce(function(d,g){return d+g}),e=a[0].data[b.w.index]?0:e,this.Z[b.w.index]=e}function Q(a,b,c){return a.pa[R(c,a.size)*a.size+R(b,a.size)]}
function ka(a,b){var c,e;return ja(function(d){switch(d.b){case 1:c=0;case 2:if(!(c<a)){d.b=0;break}e=0;case 5:if(!(e<b)){c++;d.b=2;break}return I(d,{x:c,y:e,index:e*a+c},6);case 6:e++,d.b=5}})}function R(a,b){return~~((a%b+b)%b)}[7829367,1184274,1205778].map(function(a){return[a&255,a>>8&255,a>>16&255]});function S(a,b){this.data=Array(a*b);this.width=a;this.height=b}
function qa(a){var b=document.createElement("canvas"),c=b.width=a.width,e=b.height=a.height;b=b.getContext("2d");b.drawImage(a,0,0);a=b.getImageData(0,0,c,e).data;b=new S(c,e);for(var d=0;d<c*e;d++)b.data[d]=[a[4*d],a[4*d+1],a[4*d+2]];return b}S.prototype.fill=function(a){this.data=this.data.fill(a)};function ra(a,b,c){return a.data[c*a.width+b]}function sa(a,b,c,e){a.data[c*a.width+b]=e}
function ta(a){var b=document.querySelector("canvas.game");this.g=a;this.canvas=b;this.x=0;this.y=.5;this.z=.35;this.angle=0;this.qa=.2;this.V=1;this.K=null}ta.prototype.load=function(){var a=this,b,c,e,d;return N(function(g){if(1==g.b)return b=a,I(g,ua(),2);if(3!=g.b)return b.$=g.M,c=a,e=S,d=qa,I(g,va(),3);c.I=d.call(e,g.M);wa(a);g.b=0})};
function va(){var a=void 0===a?"png":a;var b;return N(function(c){return 1==c.b?(b=document.createElement("img"),b.src="images/tilemap."+a,I(c,new Promise(function(e){b.onload=e}),2)):c["return"](b)})}
function ua(){var a=void 0===a?"png":a;var b,c,e,d,g,f,k;return N(function(h){switch(h.b){case 1:b=[];c=[];e={};for(d=0;3>d;e={v:e.v},d++)e.v=document.createElement("img"),e.v.src="images/corolla"+("000"+d).slice(-4)+"."+a,c.push(new Promise(function(l){return function(m){l.v.onload=m}}(e))),b.push(e.v);g=y(c);f=g.next();case 2:if(f.done){h.b=4;break}k=f.value;return I(h,k,3);case 3:f=g.next();h.b=2;break;case 4:return h["return"](b)}})}
function wa(a){function b(u,v,L){u-=(c-1)/2;v-=(d-1)/2;var za=f[L]*u-k[L]*v;v=k[L]*u+f[L]*v;u=za+(c-1)/2;v+=(d-1)/2;return{x:u,y:v}}for(var c=a.I.width,e=~~(c/2),d=a.I.height,g=new S(a.g.size*c,a.g.size*d),f=[1,0,-1,0],k=[0,1,0,-1],h=0;h<a.g.size;h++)for(var l=0;l<a.g.size;l++)for(var m=Q(a.g,h,l),w={},t=0;4>t;w={N:w.N},t++){var r=(t+2)%4;r=2*m+Q(a.g,h+f[r],l+k[r]);w.N=0==m?(2+f[t])/5:1;for(var p=0;p<e;p++)for(var n=p;n<d-p-1;n++){var q=b(p,n,t),D=b(p,n,r);sa(g,h*c+q.x,l*d+q.y,ra(a.I,D.x,D.y).map(function(u){return function(v){return v*
u.N}}(w)))}}h=document.createElement("canvas");h.width=g.width;h.height=g.height;document.querySelector("footer").append(h);e=h.getContext("2d");a.K=h;h=e.getImageData(0,0,h.width,h.height);for(l=0;l<g.width*g.height;l++)if(g.data[l]){for(m=0;3>m;m++)h.data[4*l+m]=g.data[l][m];h.data[4*l+3]=255}e.putImageData(h,0,0);a.L=h.data}var xa=[0,2,3,5,7,8,10],ya=[0,2,5,7,10];
function T(a,b,c,e,d){d=void 0===d?"sine":d;this.i=a;this.ua=b;this.key=c;this.U=.013;this.la=e/1E3;this.F=a.createOscillator();this.F.frequency.value=440*Math.pow(2,this.ua);this.F.type=d;this.m=a.createGain();this.m.gain.value=0;this.m.connect(this.i.destination);this.F.connect(this.m);this.F.start(a.currentTime)}
function U(a,b,c){0!=b&&(a.F.detune.value=100*a.key[(b-1)%a.key.length],b=c||a.i.currentTime,a.m.gain.setValueAtTime(0,b),a.m.gain.linearRampToValueAtTime(1/3,b+a.U),a.m.gain.linearRampToValueAtTime(0,b+a.U+a.la))}function V(a){this.o=a}function W(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];return new V(b)}V.prototype.W=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];return new V(X(this.o,b,function(e,d){return e*d}))};
V.prototype.ia=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];return new V(X(this.o,b,function(e,d){return 0!=d?e+d:0}))};V.prototype.ja=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];return new V(X(this.o,b,function(e,d){return 0!=e?e+d:0}))};function Aa(){var a=W(0,7).ia(1,3,1,5);return new V(X(a.o,Array(8),function(b,c,e,d){return b*(0==d)}))}
function X(a,b,c){for(var e=Array(a.length*b.length),d=0;d<a.length;d++)for(var g=0;g<b.length;g++)e[d*b.length+g]=c(a[d],b[g],d,g);return e}function Y(a,b){return a.o[b%a.o.length]}function Z(){}Z.prototype.start=function(){this.i=new AudioContext;this.ga=new T(this.i,-3,xa,124,"square");this.sa=new T(this.i,-2,xa,500,"sawtooth");this.ta=new T(this.i,0,ya,3E3,"triangle");this.l=0;this.ha=360;this.t=0;this.aa=null};
Z.prototype.update=function(){if(this.i){var a=this.i.currentTime,b=a-(this.aa||a);this.aa=a;this.t+=b;a=60*this.l/this.ha;.5>a-this.t&&(16<=this.l&&U(this.ga,Y(W(1,3,1,5).W(1,1,1,1),this.l),a),32<=this.l&&U(this.sa,Y(W(1,0,7,0),this.l),a),U(this.ta,Y(Aa().ja(1,3,5,1).W(1,0),this.l),a),this.l++)}};var Ba=.25/30,Ca=2/30;function Da(a,b){this.y=this.x=0;this.r=.03;this.angle=this.f=this.c=0;this.u=a;this.g=b}
Da.prototype.update=function(){var a=(!!O.up-!!O.down)*Ba,b=!!O.right-!!O.left;this.u.V=-b+1;b*=Ca;var c=Math.cos(this.angle);var e=Math.sin(this.angle);var d=Math.max(Math.min(60*(c*this.c+e*this.f),1),-1);this.angle+=b*d;this.c+=Math.cos(this.angle)*a;this.f+=Math.sin(this.angle)*a;this.x+=this.c;this.y+=this.f;c=-Math.sin(this.angle);e=Math.cos(this.angle);d=.1*(c*this.c+e*this.f);this.c-=d*c;this.f-=d*e;c=Math.cos(this.angle);e=Math.sin(this.angle);d=c*this.c+e*this.f;d*=0<d?.1:.3;this.c-=d*c;
this.f-=d*e;1!=Q(this.g,this.x,this.y)&&(this.f*=-1,this.c*=-1);d=Math.round(this.x);a=Math.round(this.y);b=this.x-d;var g=this.y-a,f=0<b?1:0,k=0<g?1:0,h=Math.sqrt(b*b+g*g),l=Math.abs(b)<this.r&&1!=Q(this.g,d-f,a-(1-k)),m=Math.abs(g)<this.r&&1!=Q(this.g,d-(1-f),a-k);f=!l&&!m&&h<this.r&&1!=Q(this.g,d-f,a-k);document.querySelector("footer>p").innerHTML="\n            rx: "+String(b).slice(0,4)+" <br>\n            ry: "+String(g).slice(0,4)+" <br>\n            colX: "+l+" <br>\n            colY: "+m+
" <br>\n            colXY: "+f+" <br>\n            x: "+String(this.x).slice(0,4)+" <br>\n            y: "+String(this.y).slice(0,4);f&&.01<h?(this.x=d+b*this.r/h,this.y=a+g*this.r/h):(l&&(this.x=d+Math.sign(b)*this.r,this.c*=-1),m&&(this.y=a+Math.sign(g)*this.r,this.f*=-1));this.u.x=this.x-.25*c;this.u.y=this.y-.25*e;this.u.z=.25+.2*(Math.sin(.78539225*this.y)+Math.sin(.78539225*this.x)+0);this.u.angle=this.angle;c=this.u;e=Date.now();d=c.canvas.width;a=c.canvas.height;b=c.canvas.getContext("2d");
b.clearRect(0,0,d,a);g=b.getImageData(0,0,d,a);h=Math.cos(c.angle);l=Math.sin(c.angle);m=Array(d).fill(0);for(f=0;180>=f;f++)for(var w=k=12*Math.pow(f/180,2),t=1-k/12,r=0;r<d;r++){var p=k*(r/d*2-1),n=c.x+h*w-l*p,q=c.y+l*w+h*p;p=c.g;p=((p.Z[R(q,p.size)*p.size+R(n,p.size)]||.2*(Math.sin(.78539225*q)+Math.sin(.78539225*n)+0))-c.z+k)/(2*k)+c.qa;var D=Math.min(~~(p*a),a),u=q;q=t;q=void 0===q?1:q;n=R(n*c.I.width,c.K.width);u=R(u*c.I.height,c.K.height);n=4*(u*c.K.width+n);n=[34*(1-q)+q*c.L[n],34*(1-q)+q*
c.L[n+1],34*(1-q)+q*c.L[n+2],34*(1-q)+q*c.L[n+3]];for(u=q=m[r];u<D;u++){var v=4*((a-u)*d+r);g.data[v]=n[0]*~~(2*R((p*a-1-u)*k,18)/18)-20*Math.random();g.data[v+1]=n[1]-20*Math.random();g.data[v+2]=n[2]-20*Math.random();g.data[v+3]=255}D>q&&(m[r]=D)}b.putImageData(g,0,0);c.$&&(g=c.$[c.V],b.drawImage(g,~~(d/2-g.width/2),~~(.8*a-g.height/2)));e=Date.now()-e;document.querySelector("footer>p").innerHTML="render time: "+e+"ms, \t"+~~(1E3/e)+"fps x: "+c.x+" y: "+c.y};window.addEventListener("load",function(){Ea()});
function Ea(){var a,b,c,e,d;N(function(g){if(1==g.b)return a=new Z,b=document.querySelector("body"),b.onkeydown=function(){a.start();b.onkeydown=null},c=new pa,e=new ta(c),I(g,e.load(),2);d=new Da(e,c);window.setInterval(function(){d.update();a.update()},1E3/30);g.b=0})};
    </script>
</head>
<body>
    <canvas width="192" height="108" class="game"></canvas>
</body>
<footer>
    <p></p>
</footer>