document.title="rec-recoil";function aa(d,p){var g=document.createElement("meta");g.name=d;g.content=p;document.head.appendChild(g)}aa("viewport","user-scalable=no,width=960");aa("monetization","$coil.xrptipbot.com/MoH6t6gjRPyZ9rYOYuj_Sw");var m=document.body.style;m.background="#000";m.width=960;m.marginLeft="auto";m.marginRight="auto";c.width=960;c.height=540;c.style.background="linear-gradient(#00f,#f04)";a.fillRect(0,0,c.width,64);a.font="12px sans-serif";var ba=document.createElement("p");ba.style.color="#ddd";ba.innerHTML='Make a rap with loops! Tap anywhere on the canvas to <b>start</b>.<br>Tap on any of the 4 <b>fish</b>, it will turn <span style="color:#fa0">orange</span> when selected. On the next loop, a <span style="color:#fff">white</span> waveform will appear from the sound of the mic. Talk into your <b>mic</b> and the fish will eat the sound. From the next loop, the fish will play back the sound.<br>Tap the area above the water (at the top of the canvas) to <b>stop</b> at the end of the loop, the visualizer will turn <span style="color:#777">black</span>. Tap there again to change <b>visualizers</b>.<br><br><b>Microphone</b> required for recording.<br>Due to lack of support for the MediaRecorder API, <b>recording will not work on iOS/Safari/Edge</b>. It works on Android/Chrome/Firefox.';document.body.appendChild(ba);for(var ca,r,x,z,A,da,G,H,K,L,ea=0,la=0,ma="",M,N,O=[],S="#fff #f0f #ff0 #0ff #0f0 #fa0".split(" "),na=(c.height-64)/4,T=new Uint8Array(128),oa=new Uint8Array(1024),U=0;6>U;++U)O[U]={},U&&(O[U].b=new Audio);window.MediaRecorder?navigator.mediaDevices.getUserMedia({audio:!0}).then(function(d){K=d;c.onmousedown();N=new MediaRecorder(d);N.ondataavailable=function(p){O[A].b.src=URL.createObjectURL(p.data);O[A].b.currentTime=.1;O[A].b.play();A=0}})["catch"](function(){K=1;c.onmousedown()}):K=1;var pa=new function(){function d(b){return Math.sin(6.283184*b)}var p=[d,function(b){return.5>b%1?1:-1},function(b){return b%1*2-1},function(b){b=b%1*4;return 2>b?b-1:3-b}],g,h,e,y,k;this.s=function(){var b={v:[{a:[0,255,116,1,0,255,116,0,1,0,4,6,35,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1],g:[{n:[135,,135,,,,135,135,,,135,,,,135,,135,,135,,,,135,135,,,135,,,,135],h:[]}]},{a:[0,160,128,1,0,160,128,0,1,210,4,7,41,0,0,0,60,4,1,2,255,0,0,32,61,5,32,6],p:[1],g:[{n:[,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135],h:[]}]},{a:[0,0,140,0,0,0,140,0,0,60,4,10,34,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],p:[1],g:[{n:[135,,135,,,,135,135,135,,135,,,,135,135,135,,135,,,,135,135,135,,135,,,,135],h:[]}]}],j:5513,i:32,m:0,u:3};g=b;h=b.m;e=0;y=b.j*b.i*(h+1)*2;k=new Int32Array(y)};this.o=function(){var b,t,v,f,u,q=new Int32Array(y),l=g.v[e],I=g.j,V=g.i,fa=0,W=0,B;var C=!1;var X=[];for(t=0;t<=h;++t){var P=l.p[t];for(v=0;v<V;++v){if(u=P?l.g[P-1].h[v]:0)l.a[u-1]=l.g[P-1].h[v+V]||0,16>u&&(X=[]);var Aa=p[l.a[15]],Ba=l.a[16]/512,Ca=Math.pow(2,l.a[17]-9)/I,Da=l.a[18],ra=l.a[19],Ea=135.82764118168*l.a[20]/44100,Fa=1-l.a[21]/255,ha=1E-5*l.a[22],Ga=l.a[23]/32,Ha=l.a[24]/512,Ia=6.283184*Math.pow(2,l.a[25]-9)/I,sa=l.a[26]/255,ia=l.a[27]*I&-2;u=(t*V+v)*I;for(f=0;4>f;++f)if(b=P?l.g[P-1].n[v+f*V]:0){if(!X[b]){var n=X;var E=b;var ta=B=void 0,Y,D,w=l,ua=b,Ja=p[w.a[0]],Ka=w.a[1],La=w.a[3],Ma=p[w.a[4]],Na=w.a[5],Oa=w.a[8],va=w.a[9],J=w.a[10]*w.a[10]*4,Z=w.a[11]*w.a[11]*4,ja=w.a[12]*w.a[12]*4,Pa=1/ja,Q=w.a[13],Qa=I*Math.pow(2,2-w.a[14]),wa=new Int32Array(J+Z+ja),xa=0,ya=0;for(Y=D=0;D<J+Z+ja;D++,Y++){0<=Y&&(Q=Q>>8|(Q&255)<<4,Y-=Qa,ta=.003959503758*Math.pow(2,(ua+(Q&15)+w.a[2]-128-128)/12),B=.003959503758*Math.pow(2,(ua+(Q&15)+w.a[6]-128-128)/12)*(1+8E-4*w.a[7]));var F=1;D<J?F=D/J:D>=J+Z&&(F-=(D-J-Z)*Pa);var R=ta;La&&(R*=F*F);xa+=R;var ka=Ja(xa)*Ka;R=B;Oa&&(R*=F*F);ya+=R;ka+=Ma(ya)*Na;va&&(ka+=(2*Math.random()-1)*va);wa[D]=80*ka*F|0}n[E]=wa}E=X[b];b=0;for(n=2*u;b<E.length;b++,n+=2)q[n]+=E[b]}for(b=0;b<I;b++)f=2*(u+b),(n=q[f])||C?(C=Ea,Da&&(C*=Aa(Ca*f)*Ba+.5),C=1.5*Math.sin(C),fa+=C*W,n=Fa*(n-W)-fa,W+=C*n,n=3==ra?W:1==ra?n:fa,ha&&(n*=ha,n=1>n?-1<n?d(.25*n):-1:1,n/=ha),n*=Ga,C=1E-5<n*n,E=Math.sin(Ia*f)*Ha+.5,B=n*(1-E),n*=E):B=0,f>=ia&&(B+=q[f-ia+1]*sa,n+=q[f-ia]*sa),q[f]=B|0,q[f+1]=n|0,k[f]+=B|0,k[f+1]+=n|0}}e++;return e/g.u};this.l=function(){var b=44+2*y-8,t=b-36,v=new Uint8Array(44+2*y);v.set([82,73,70,70,b&255,b>>8&255,b>>16&255,b>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,t&255,t>>8&255,t>>16&255,t>>24&255]);b=0;for(t=44;b<y;++b){var f=k[b];f=-32767>f?-32767:32767<f?32767:f;v[t++]=f&255;v[t++]=f>>8&255}return v};this.getData=function(b,t){for(var v=2*Math.floor(44100*b),f=Array(t),u=0;u<2*t;u+=1){var q=v+u;f[u]=0<b&&q<k.length?k[q]/32768:0}return f}};pa.s();var qa=setInterval(function(){if(da=1<=pa.o())clearInterval(qa),c.onmousedown()},0);c.onmousedown=function(d){if(M)M.resume(),d=Math.ceil(((d.touches?d.touches[0].pageY:d.pageY)-c.offsetTop-64)/na),M.currentTime-L>O[0].f.duration&&(x=0),d&&x?z||(A=A!=d?d:0):r?(r=0,ca=!ca):x?r=1:(L=M.currentTime,za());else if(K&&da){M=new (window.AudioContext||window.webkitAudioContext);H=M.createAnalyser();H.connect(M.destination);G=M.createGain();G.connect(H);for(d=0;6>d;++d)if(O[d].c=M.createAnalyser(),O[d].c.fftSize=2*T.length,5>d&&O[d].c.connect(G),5==d&&1!=K){var p=M.createMediaStreamSource(K);p.connect(O[d].c)}else d&&5>d&&(p=M.createMediaElementSource(O[d].b),p.connect(O[d].c));d=pa.l();M.decodeAudioData(d.buffer,function(g){O[0].f=g;L=M.currentTime;za();Ra(0)})}};function za(){r=0;x=1;for(var d=0;5>d;++d)if(O[d].f){var p=M.createBufferSource();p.buffer=O[d].f;p.connect(O[d].c);p.start(0);p.onended=function(){r?x=r=0:(L=M.currentTime,N&&A&&(z?(N.stop(),z=0,G.gain.setValueAtTime(1,M.currentTime)):(G.gain.setValueAtTime(.1,M.currentTime),N.start(),z=1)),za())}}else O[d].b.src&&(O[d].b.currentTime=.1,O[d].b.play())}function Ra(d){function p(l){l=Math.sin(2*(t+l)*Math.PI);k=a.createRadialGradient(u+16,b-8*l,0,u+16,b-8*l,48);k.addColorStop(0,"rgba(191,255,255,0)");k.addColorStop(1,"rgba(191,255,255,1)");a.fillStyle=k;a.beginPath();a.moveTo(u,b);a.quadraticCurveTo(u+40,b-16-16*l,u+48,b-16*l);a.quadraticCurveTo(u+40,b+16-16*l,u,b);a.fill()}a.clearRect(0,0,c.width,c.height);var g=c.width/T.length;a.lineWidth=1;for(var h=0;5>h;++h)if(!h||O[h].b.src)if(O[h].c.getByteFrequencyData(T),ca)for(var e=T.length-1;0<=e;--e){var y=T[e]/-255*c.height,k=a.createLinearGradient(0,c.height,0,c.height+y);k.addColorStop(0,"rgba(0,0,0,0)");k.addColorStop(1,r?"#000":S[h]);a.fillStyle=k;a.fillRect((e+h/5)*g,c.height,1,y)}else{a.strokeStyle=r?"#000":S[h];a.beginPath();for(e=T.length/2;0<=e;--e){var b=541-2*T[e];a.moveTo(15*(e+1),b);a.lineTo(15*e,b)}a.stroke()}g=(oa.length-c.width)/2;H.getByteTimeDomainData(oa);a.fillStyle="#000";a.beginPath();a.moveTo(c.width,0);for(h=c.width;0<=h;--h)a.lineTo(h,oa[h+g]/2);a.lineTo(0,0);a.fill();g=((L-M.currentTime)/O[0].f.duration+1)*c.width;a.lineWidth=2;a.strokeStyle="#fff";a.beginPath();for(h=1;5>h;++h)if(b=na*(h-.5)+64,z&&h==A)for(O[5].c.getByteTimeDomainData(T),a.moveTo(g+64,b),y=(g+64)/T.length,e=T.length-1;0<=e;--e)a.lineTo(y*e,b+(T[e]-128)/2);else if(O[h].b.src)for(O[h].c.getByteTimeDomainData(T),a.moveTo(g+64,b),e=T.length-1;0<=e;--e)a.lineTo(g-64+e,b+(T[e]-128)/4);a.stroke();var t=(M.currentTime-L)%(O[0].f.duration/4);e=Math.sin(2*t*Math.PI);y=80+4*e;var v=g-56,f=g-48,u=g+80;for(h=1;5>h;++h){b=na*(h-.5)+64;k=a.createRadialGradient(g-32,b,0,g,b,80+4*e);k.addColorStop(0,"rgba(255,255,255,0)");k.addColorStop(1,h==A?S[5]:S[h]);a.fillStyle=k;a.beginPath();a.moveTo(g-64,b);a.lineTo(g-80,b-8);a.quadraticCurveTo(g,b-y,g+80,b);a.quadraticCurveTo(g,b+y,g-80,b+8);a.fill();var q=b-16-e;k=a.createRadialGradient(v,q,0,v,q,16);k.addColorStop(0,"rgba(255,255,255,0)");k.addColorStop(1,"rgba(255,255,255,1)");a.fillStyle=k;a.beginPath();a.ellipse(v,q,8,12,0,0,2*Math.PI);a.fill();q=b-32-2*e;k=a.createRadialGradient(f+32,q-4*e,0,f+32,q-4*e,32);k.addColorStop(0,"rgba(255,255,191,0)");k.addColorStop(1,"rgba(255,255,191,1)");a.fillStyle=k;a.beginPath();a.moveTo(f,q);a.quadraticCurveTo(f+32,q-32-8*e,f+64,q-16-8*e);a.fill();p(0);p(1/3);p(2/3)}ea++;984<d-la&&(ma=ea+"fps",la=d,ea=0);a.fillStyle="#333";a.fillText(ma,1,10);requestAnimationFrame(Ra)};